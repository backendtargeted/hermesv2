var $pinc;$pinc.bubble=new function(){function y(){return}function h(){try{var i=e.filter(t=>t.sharedKey==n.settings.publicKey),t=i.length==0;$pinc.events.on("$pinc.modals","ready",()=>{if(n.settings.plugin!="bubble.connector")t?n.devMode()&&$pincj.post($pinc.environment.azHost+"azoauth/update_alternate_registration",JSON.stringify({clientId:n.settings.provider_client_id,clientSecret:n.settings.provider_client_secret,domain_key:n.settings.partnerKey.split(".")[0],scope:n.settings.provider_scopes,title:n.settings.provider_title,provider:n.settings.provider})):n.pathfixRegister(n.settings,t=>{(t.rows[0].mode=="new"||$pinc.isNullOrEmpty(n.settings.partnerKey))&&c(t)});else{if(n.settings.partnerKey!=null&&n.settings.publicKey!=null){$pinc.modals.alert({message:`
                            <div class="d-flex flex-column" style="line-height:1.5">
                                <div class="text-center">
                                    <img src="${$pinc.environment.imageHost}i/pathfix-full.png" style="height:32px"/>
                                </div>
                                <div class="mt-3" style="max-width:500px;">
                                    <div class="mt-3">Plugin Name: Pathfix OAuth Connector</div>
                                    <div class="mt-3">You have provided both, the <b>Public Key</b> and <b>x-partner-key</b> in your plugin configuration. Only one of the following is allowed...</div>
                                    <ul class="mt-3">
                                        <li>Have a Pathfix Account: Only Public Key</li> 
                                        <li>Don't have a Pathfix Account - Only x-partner-key</li> 
                                    </ul>
                                    <div class="mt-3 text-sm">Documentation: https://docs.pathfix.com/bubble/pathfix-keys"</div>
                                </div>    
                            </div>    
                            `,header:"Plugin Configuration Error!"});return}if(t||n.settings.publicKey!=null)return;n.register(n.settings,t=>{(t.rows[0].mode=="new"||$pinc.isNullOrEmpty(n.settings.partnerKey))&&c(t)})}},!0,!0)}catch(r){}}var o={},n=this,e=[{sharedKey:"BE22EF40-C956-4E73-89CA-E0619F2545B8"}],u,v,t;this.nck=e;this.settings;u=document.getElementById("pinc.helper");u.setAttribute("data-auth-auto-init",!1);var s=!1,i,r=2.5,f=2.5;this.initialize=t=>{n.settings=t;h();$pinc.events.on("$pinc.modals","ready",()=>{$pinc.modals.loading("Loading connections...");$pinc.events.on("$pinc.oauth","integrations",()=>{$pinc.modals.loading(),$pincBubbleOauth.readyState="ready",n.render()},!0)},!0)};this.getSettings=(n,t)=>{var u,i,r;return t=t||{},u=n.keys["Public Key"]||"BE22EF40-C956-4E73-89CA-E0619F2545B8",i={publicKey:t.publicKey||u,partnerKey:n.keys["x-partner-key"],user_id:t.userId||o["User Id"]||n.currentUser.get("_id"),user_email:n.currentUser.get("email"),software:"bubble",plugin:"bubble.sso",providers:t.providers||"",reg_email:n.keys["Email Id"],provider:t.provider,provider_client_id:n.keys[t.client_id_property||"client_id"],provider_client_secret:n.keys[t.client_secret_property||"client_secret"],custom:t},$pinc.isNullOrEmpty(t.provider)||(i.provider_title=t.provider_display[t.provider].title),$pinc.isNullOrEmpty(i.partnerKey)||(r=i.partnerKey.split("."),r.length>1&&$pinc.isNullOrEmpty(t.publicKey)&&(i.publicKey=r[0])),i};this.initializePreview=()=>{var n=window.location.hostname};this.devMode=()=>{var n=new URL(window.location);return n.hostname.indexOf("bubbleapps.io")>0&&n.searchParams.get("debug_mode")=="true"};this.register=()=>{};this.pathfixRegister=(n,t)=>{if($pinc.isNullOrEmpty(n.reg_email)||$pinc.isNullOrEmpty(n.provider_client_id)||$pinc.isNullOrEmpty(n.provider_client_secret)){$pinc.modals.alert({message:`Complete the following information to proceed with Plugin Activation
                <ul class="my-2 ">
                    <li>
                        <div class="font-weight-bold my-2 d-inline-block">${n.custom.client_id_property||"Client Id"}:</div>
                        <span >${n.provider_client_id||`<span class="text-danger">incomplete</span>`}</span>

                    </li>
                    <li>
                        <div class="font-weight-bold my-2 d-inline-block">${n.custom.client_secret_property||"Client Secret"}:</div>
                        <span >${n.provider_client_secret||`<span class="text-danger">incomplete</span>`}</span>
                    </li>
                    <li>
                        <div class="font-weight-bold my-2 d-inline-block">Email Id:</div>
                        <span>${n.reg_email||`<span class="text-danger">incomplete</span>`}</span>
                    </li>
                </ul>`,header:`
                    <div class="d-flex align-items-center">
                        <img src="${$pinc.environment.imageHost}i/pathfix-icon.png"  class="mr-2" style="height:1rem"/>
                        <div>
                            Plugin Activation
                        </div>
                    </div>`});return}var i=new URL(window.location.href);$pincj.get($pinc.environment.azHost+"profiles/createintegration",{plugin:n.plugin,software:`${i.hostname}`,email:"bubble."+n.reg_email,provider:n.provider,client_id:n.provider_client_id,client_secret:n.provider_client_secret,title:n.provider_title||n.provider,scope:n.provider_scopes}).always(n=>{t!=null&&t(n)})};var c=t=>{var i=window.location.hostname,r=t.rows[0].x_partner_key||t.rows[0].reg_id;$pinc.modals.alert({message:`<div class="d-flex flex-column" style="line-height:1.5">
                                        <div class="text-center">
                                            <img src="${$pinc.environment.imageHost}i/pathfix-full.png" style="height:32px"/>
                                        </div>
                                        <div class="mt-3" style="max-width:500px;text-align:center">
                                            <b>Thank you for adding this Plugin to your no-code app!</b><br> 
                                            Here are some final instructions before you continue...
                                        </div>
                                        <ul class="mt-3">
                                            <li>
                                                <div class="d-flex align-items-center">
                                                    <b class="flex-grow-1" style="min-width:120px;max-width:120px">your software</b>
                                                    <div class="flex-grow-1">${i}</div>
                                                </div>
                                            </li>
                                            <li>
                                                <div class="d-flex align-items-center">
                                                    <b class="flex-grow-1" style="min-width:120px;max-width:120px">your email</b>
                                                    <div class="flex-grow-1">${n.settings.reg_email||n.settings.email||"unknown"}</div>
                                                </div>
                                            </li>
                                            <li>
                                                <div class="d-flex align-items-center">
                                                    <b class="flex-grow-1 " style="min-width:120px;max-width:120px">x-partner-key</b>
                                                    <div class="flex-grow-1 text-sm">${r}</div>
                                                    <button class="ml-3 btn btn-sm btn-outline-secondary copy-key cursor-pointer">Copy</button> 
                                                </div>
                                            </li>
                                        </ul>
                                        <div class="mt-3" style="max-width:500px">
                                            <p>Copy the x-partner-key into the Plugins section of your app for every Pathfix plugin installed on ${i}.</p>

                                            <p class="mt-3">
                                                Reach out to support@pathfix.com for any queries or assistance
                                            </p>
                                        </div>
                                    </div>`,header:"Plugin Activated!"});$pincj(".copy-key").on("click",()=>{$pinc.copy(r),$pincj(".copy-key").text("Copied")})},l={},a=[];this.authorized=(n,i,r)=>{$pinc.events.on("$pinc.oauth","ready",()=>{console.log($pinc.oauth),$pinc.oauth.authorized(r.provider,r.userId,n=>{n=n?"yes":"no",t.publishState("authorized_action_state",n),t.publishState("authorized_action_provider",r.provider)})},!0,!0)};this.connect=(t,i,r)=>{var u=n.getSettings(i),f=$pinc.isNullOrEmpty(r.public_key)?u.publicKey:r.public_key;r.clientId=f;$pinc.oauth.processCommand(r)};this.disconnect=(t,i,r)=>{var u=n.getSettings(i),f=$pinc.isNullOrEmpty(r.public_key)?u.publicKey:r.public_key;r.clientId=f;$pinc.oauth.revoke(r.provider,r.userId,r.clientId)};this.connectionNames=(t,r)=>{$pinc.events.on("$pinc.bubble","instance",()=>{var t=n.getSettings(r);$pinc.events.on("$pinc.oauth","ready",()=>{$pinc.oauth.client.connectionNames({clientId:t.publicKey,userId:t.user_id},n=>{var t=[];a=n;n.forEach(n=>{t.push(n.name)});i.publishState("connection_names",t)})},!0,!0)},!0,!0)};this.connectionProp=n=>{var t=n.property;t=t=="virtual_user_id"?"map_id":t;i.publishState("connection_property",(a.filter(t=>t.name==n.name)[0]||{})[t])};v=t=>{var i,r,u,f;if(n.settings.custom.scopes!=null)if($pinc.isNullOrEmpty(t.custom_scope)){i=[];i.push(n.settings.custom.scopes.default||"");for(r in t)r.indexOf("scopes_")==0&&t[r]==!0&&i.push(n.settings.custom.scopes[r.replace("scopes_","")]);u=n.settings.provider_scope_seperator||",";f=new RegExp(`${u}${u}`,"g");n.settings.provider_scopes=i.join(u)}else n.settings.provider_scopes=t.custom_scope};this.setProperty=n=>{o[n.property]=n.value};this.initializeInstancePropertiesV1=(t,i,u,f)=>{t.triggerEvent("onload"),r=f||r,n.initializeInstanceProperties(t,i,u)};this.initializeConnection=(i,r,e,o)=>{function h(n,i,r){t.publishState("consented_provider",i);t.publishState("consented_user",n);f>2.7&&!$pinc.isNullOrEmpty(r)&&t.publishState("connection_name",r);t.triggerEvent("consented",()=>{})}if(f=o||f,t==null||t.canvas[0]!==i.canvas[0]){t=i;var s=n.getSettings(e);if(y(s),u.setAttribute("data-oauth-client-id",s.publicKey),f>2.6){$pinc.events.on("$pinc.oauth","consented",n=>{h(n.userId,n.provider,n.name)});$pinc.events.on("$pinc.oauth","consentRedirect",n=>{n.provider!=null&&h(null,n.provider,null)},!0,!0);$pinc.events.on("$pinc.oauth","notConsented",()=>{t.publishState("consented_provider",null),t.triggerEvent("not_consented",()=>{})});$pinc.events.on("$pinc.oauth","revoked",n=>{try{t.publishState("consented_provider",n.provider);t.publishState("consented_user",n.userId);t.triggerEvent("disconnected",()=>{})}catch(i){}})}}};this.initializeInstanceProperties=(t,f,e,o)=>{var c,a;try{if(i=t,c=t.canvas.attr("pinc-initialized")=="1",c)return;if(a=$pinc.getGuid(),l[a]={properties:f,instance:t,instanceId:a,rendered:!1},n.settings=n.getSettings(e,{publicKey:f.public_key,userId:f.user_id,providers:f.providers}),n.settings.plugin=n.settings.custom.module||"bubble.connector",v(f),u.setAttribute("data-oauth-user-id",n.settings.user_id),!s){s=!0;h();$pinc.events.on("$pinc.oauth","consented",n=>{y(n.provider,n.userId,n.name)});$pinc.events.on("$pinc.oauth","consentRedirect",n=>{n.provider!=null&&y(n.provider,null,null)},!0,!0);$pinc.events.on("$pinc.oauth","notConsented",()=>{i.publishState("consented_provider",null),i.triggerEvent("not_consented",()=>{})});$pinc.events.on("$pinc.oauth","revoked",n=>{try{i.publishState("consented_provider",n.provider);r>=2.6&&i.publishState("consented_user",n.userId);i.triggerEvent("disconnected",()=>{})}catch(t){}})}if(c=t.canvas.attr("pinc-initialized")=="1",$pinc.events.fire("$pinc.bubble","instance"),c)return;if(t.canvas.attr("pinc-initialized","1"),o==!1)return;n.render(l[a]);function y(n,t,u){i.publishState("consented_provider",n);r>=2.6&&i.publishState("consented_user",t);r>2.7&&!$pinc.isNullOrEmpty(u)&&i.publishState("connection_name",u);i.triggerEvent("consented",()=>{})}}catch(y){console.log("ERROR Caught in initializeInstanceProperties");setTimeout(()=>{n.initializeInstanceProperties(t,f,e)},100)}};this.render=t=>{var f,i,r,o;if(!t.rendered){var u=t.properties,s=`<div 
                                id="el_${t.instanceId}"
                                data-oauth-client-id="${n.settings.publicKey}"
                                data-oauth-user-id="${n.settings.user_id}"
								data-oauth-ui="list-columns" 
								data-oauth-ui-switches="statusOn,disconnect${u.allow_multi?",multi":""}" 
								data-oauth-icon-size="Medium" 
								data-oauth-button-color="#007BFF" 
								data-oauth-ui-providers="{{providers}}"
                                data-oauth-consent-mode="${$pinc.isNullOrEmpty(u.consent_mode)?"popup":u.consent_mode}"
								data-oauth-ui-providerTypes="">
							</div>`,e=t.instance;if(e.canvas.css({height:"auto"}),$pinc.isNullOrEmpty(n.settings.providers)){i=[];for(r in t.properties)r.indexOf("plugin_")==0&&t.properties[r]==!0&&i.push(r.replace("plugin_",""));if(o=t.properties.all_providers==!0,i.length==0&!o)return e.canvas.html("<div>No providers selected for display<\/div>");f=i.join(",")}else f=n.settings.providers;t.instance.canvas.html($pinc.dataReplace(s,{providers:f}));$pinc.events.on("$pinc.oauth","ready",()=>{$pinc.oauth.rebind()},!0,!0);t.rendered=!0}}};$pinc.bubble.sso=new function(){function s(n){if(n!=null){var t=$pinc.bubble.getSettings(n);return r.setAttribute("data-auth-client-id",t.publicKey),t}}function h(n){return app.app_version!="test"?!0:$pinc.isNullOrEmpty(n.publicKey)||n.publicKey==$pinc.bubble.nck[0].sharedKey?($pinc.modals.alert({message:`
                    <div class="d-flex flex-column" style="line-height:1.5;">
                        <div class="text-center">
                            <img src="${$pinc.environment.imageHost}i/pathfix-full.png" style="height:20px"/>
                        </div>
                        <div class="mt-3" style="max-width:800px;font-size:.8rem">
                            <div class="mt-3">
                                <p>Pathfix's Bubble SSO plugin comes pre-configured with default provider credentials that lets you add SSO integrations without configuring the provider in your Pathfix account. 
                                   This allows you to test the functionality and workflows in your app <b>before you go live</b>
                                <p>
                                <p class="mt-3">However, since these are Pathfix credentials, that means any live apps that use the default plugin credentials are being authorized for Pathfix - i.e. your users' authentication is for the Pathfix app with each provider.</p>
                                <p  class="mt-3">Security is of the utmost importance to us. We want to make sure your integrations are complying with the SSO providers needs and is being <b>authenticated for you, not Pathfix</b>.</p>
                                <p  class="mt-3"><b>The Change</b></p>
                                <p >To maintain privacy and security of your app and it's users, you will <b>no longer be able to go live with the default credentials from <span class="text-danger">September 7, 2022</span>.</b></p>
                                <p  class="mt-3">You can continue to use the default credentials in your development/test environment only.</p>
                                <p  class="mt-3">What Should You Do Next?</p>
                                <p>
                                <ol>
                                    <li>Register your app with each service provider (here is a <a class="text-primary" href="https://docs.pathfix.com/identity-auth">step by step guide</a> on a few Identity auth providers)</li>
                                    <li>Add the integration in your <a class="text-primary" href="https://app.pathfix.com">Pathfix account</a></li>
                                    <li>Copy the Public Key from the <a class="text-primary" href="https://docs.pathfix.com/bubble/pathfix-keys">keys section</a> of your account and add it to the Public Key section of the SSO Plugin in Bubble</li>
                                </ol>
                                <p  class="mt-3">
                                <p  class="mt-3">
                                    We recommend you log in to your Pathfix account now and make the changes to your plugin at the earliest to avoid any service disruption to your users.
                                </p>
                                <p  class="mt-3">
                                    As always, do reach out if you need any assistance with your integrations and we would be happy to assist you.
                                </p>
                                <p  class="mt-3">
                                    <b><i>Note: This message will not appear in your live environment</i></b>
                                </p>
                            </div>
                        </div>    
                    </div>    
                    `,header:"Configuration Alert for Plugin - SSO Login (Multiple Providers)!"}),f=!0,!1):!0}function e(n,t,i){var l,o,c;try{l=n.currentUser.get("_id")}catch(a){return console.log("Handler for bubble error"),setTimeout(()=>{e(n,t,i)},100)}if($pinc.trace("-->_initializeSettingsForUI"),o=s(n),f||h(o),t!=null){o.providers=[];for(c in t)c.indexOf("plugin_")==0&&t[c]==!0&&o.providers.push(c.replace("plugin_",""));o.providers.length>0&&(r.setAttribute("data-ui-providers",o.providers),r.setAttribute("data-auth-session-duration",t.session_duration||"2880"),r.setAttribute("data-ui-button-prefix","Login with"))}if(i!=null||u||($pinc.bubble.register(o),u=!0,$pinc.auth.init()),i!=null)$pinc.events.on("$pinc.auth","sessionschecked",i,!0,!0)}function c(){var n=window.screen.availHeight*.6,t;return n>600&&(n=600),t=window.screen.availWidth*.6,t>700&&(n=700),{h:n,w:t}}var t=this,u,f,i,n;this.profile=null;var r=document.getElementById("pinc.helper"),o={Google:"google",LinkedIn:"linkedin","LinkedIn v2":"linkedinv2",Facebook:"fb",GitHub:"github",Microsoft:"ms","Azure AD":"msazuread",Twitter:"twitter",Spotify:"spotify",Amazon:"amazon",Apple:"apple",Kakao:"kakao",Naver:"naver",Discord:"discord"};this.startLogin=(n,t)=>{$pinc.events.on("$pinc.auth","ready",()=>{var i=`${o[n.provider]}identity`,r=$pinc.bubble.getSettings(t,{publicKey:n.publicKey});window.onbeforeunload=null;$pinc.oauth.processCommand({provider:i,method:"call",clientId:r.publicKey},!1)},!0,!0)};u=!1;this.init=()=>{$pinc.events.on("$pinc.ui.auth","loggedin",t.loggedIn);$pinc.events.on("$pinc.ui.auth","loggedout",t.loggedOut);$pinc.events.on("$pinc.auth","ready",()=>{$pinc.events.fire("$pinc.bubble.sso","ready")},!0,!0)};f=!1;this.initializeUI=(n,t,i)=>{e(t,i,()=>{var t=$pinc.getGuid(),i=$pincj(n.canvas).find("[data-auth-render]"),r,u;i.length==0?(r=`<div id="${t}" data-auth-render="always"></div>`,u=new URL(window.location),n.canvas.html(r)):t=i.prop("id");$pinc.ui.auth.render($pincj(`#${t}`));$pincj(".configure").on("click",()=>{var n=c(),t=`location=yes,height=${n.h},width=${n.w},left=${(window.screen.availWidth-n.w)/2},top=${(window.screen.availHeight-n.h)/2},scrollbars=yes,status=yes`;window.open("https://app.pathfix.com/lite","_blank",t)})})};this.loginStatus=(n,t)=>{t!=null&&(i=t),e(n)};i=2.3;this.setBubbleStates=r=>{n=r||n;try{t.profile!=null?(n.publishState("sso_email",t.profile.email),n.publishState("sso_name",t.profile.name),i>=2.4&&(n.publishState("sso_fname",t.profile.firstName),n.publishState("sso_lname",t.profile.lastName)),i>=2.7&&n.publishState("sso_oauthid",t.profile.oauthId),i>=2.8&&($pinc.isNullOrEmpty(t.profile.phone)||n.publishState("sso_phone",t.profile.phone.toString())),n.publishState("sso_provider",t.profile.provider),n.publishState("sso_set",!0),n.publishState("sso_not_set",!1),n.publishState("sso_pic",t.profile.pic),n.publishState("sso_id",t.profile.id.toString()),n.publishState("sso_handle",t.profile.handle)):(n.publishState("sso_email",null),n.publishState("sso_name",null),i>=2.4&&(n.publishState("sso_fname",null),n.publishState("sso_lname",null)),n.publishState("sso_provider",null),n.publishState("sso_set",!1),n.publishState("sso_not_set",!0),n.publishState("sso_pic",null),n.publishState("sso_id",null),n.publishState("sso_handle",null))}catch(u){}};this.loggedIn=()=>{t.profile=$pinc.auth.profile,$pinc.events.fire("$pinc.bubble.sso","loginstatus")};this.loggedOut=()=>{t.profile=null,$pinc.events.fire("$pinc.bubble.sso","loginstatus")};this.signOut=()=>{$pinc.auth.signOut(),t.loggedOut(),t.setBubbleStates()};this.configure=()=>{$pinc.modals.window({src:`${$pinc.environment.codeHost}sso.html?v=${$pinc.environment.codeVersion}&user_id=system@pathfix.com`,width:"80vw;max-width:1000px",height:"80vh",noClose:!0})}};$pinc.events.fire("$pinc.bubble","load");typeof $pinc=="undefined"&&($pinc={});$pinc.popups=new function(){function r(i){if(n.length!=0&&i.key==="Escape"){var r=n[n.length-1];if(r.hideable!=!0)return;t(r.popup,r.overlay)}}function t(t,i){i.removeClass("fadeIn");i.addClass("fadeOut");t.removeClass("show");n.pop()}function f(n,r){var e=(r||{overlay:{}}).overlay||{},f=$pinc.getGuid(),u;$pincj(document.body).append(i.replace(/#id#/g,f));u=$pincj("#"+f);u.css("z-index",$pinc.environment.highestZIndex++);e.transparent==!0&&u.css("background","rgba(0,0,0,0)");u[0].addEventListener("animationend",()=>{u.hasClass("fadeOut")&&u.remove()});u.removeClass("d-none");u.on("click",()=>{t($pincj(n),u)});return $pincj(n).data().overlayId=f,u}function e(i){function h(){var n=f(r,i);n.unbind();n.on("click",o);return n}function c(){var n=$pincj(i.attachedTo),t,u;n.length!=0&&(t=n[0].getBoundingClientRect(),u=document.body.getBoundingClientRect(),$pincj(document.body).append(r),r.addClass("pinc-attached-popup"),r.addClass("pinc-show-for-dim"),r.unbind(),r.removeClass("pinc-show-for-dim"))}function o(){var n=!0;if(i.beforeClose!=null)try{n=i.beforeClose()}catch(f){}if(n&&(t(r,u),i.onclose!=null))try{i.onclose()}catch(f){}}function l(){r.removeClass("d-none");r.addClass("show");r.focus();$pincj(document.body).addClass("pinc-popup-on")}var r=$pincj(i.element),s=$pinc.getGuid(),u,e;r.data().popupId=s;u=h();r.addClass("pinc-popup");e=r.find(`[data-dismiss="modal"]`);e.on("click",o);n.push({popup:r,overlay:u,hideable:e.length>0||i.allowDismiss==!0});r.off("click");r.on("click",function(n){$pincj(n.target).closest(".pinc-popup-dialog").length>0&&!$pincj(n.target).hasClass("pinc-popup-dialog")||o(n)});r.css("z-index",$pinc.environment.highestZIndex++);c();l()}var i="<div id='#id#' class='pinc-popup-overlay d-none animated fadeIn' ><\/div>",n=[],o=new Map,u;this.init=function(){$pinc.loadcss(`${$pinc.environment.codeHost}popups.css?v=${$pinc.environment.codeVersion}`);document.addEventListener("keyup",r)};u=!1;this.hide=function(n){var i=$pincj(n.element),r=$pincj("#"+i.data().overlayId);t(i,r)};this.create=function(n){var t=$pinc.getGuid();return $pincj(document.body).append("<div class='pinc-popup d-none' id='"+t+"'><div class='pinc-popup-dialog pinc-popup-dialog-centered'><div class='pinc-popup-content animated fadeInDown'><\/div><\/div><\/div>"),$dialog=$pincj("#"+t),$dialog.find(".pinc-popup-content").append($pincj(n).clone(!0)),t};this.show=function(n){var t=new e(n)};this.pagePopups=function(){function t(n,t){var i=!1;this.visible=function(r){if(r==null)return i;r==!0?(n.element.removeClass(`fadeOut${t}`),n.element.addClass(`fadeIn${t}`),$pinc.popups.show({element:n.element,overlay:{transparent:!0},allowDismiss:!0}),i=!0):(n.element.removeClass(`fadeIn${t}`),n.element.addClass(`fadeOut${t}`),$pinc.popups.hide({element:n.element}),i=!1)}}var n=this;this.add=function(i,r,u,f){if(f==null&&(f=function(){}),n[r]!=null)return f();if($pinc.pageLoader==null)return console.log("Missing reference to $pinc.pageLoader");$pinc.pageLoader.loadPage({url:i},function(i){var e=document.createElement("div");e.innerHTML=i.response;e.firstChild.id=i.id;e=e.innerHTML;$pincj(document.body).append(e);$pinc.pageLoader.addPage(i);n[r]=new t(i,u);f()})}}};$pinc.popups.init();$pinc.jsonMap=new function(){function i(n,i){var u="",e,s,o,f,h;return i!=null&&(e=[],t(e,i,"/"),s=`
                    <div>
                        <label class="text-sm font-weight-bold">#filedName#</label>
                        <div class="input-group input-group-{{inputSize}} mb-3 map-field position-relative" data-field="#fieldId#">
                          <div type="text" class="form-control overflow-hidden selected-map-items " data-toggle="dropdown">#mappedItems#</div>
                          <div class="input-group-append map-drop-down">
                            <button type="button" class="btn btn-outline-secondary dropdown-toggle" data-flip="false" data-toggle="dropdown"></button>
                            <div class="dropdown-menu text-sm dropdown-menu-right shadow dd-map-fields border pt-0 mb-5" style="width:100%;translate3d(0px, 40px, 0px) !important;" >
                                <div class="px-3 panel-bg-color py-2">
                                    <h4>Pick fields from <span class="sel-source-display"></span></h5>
                                    <label>Search</label>
                                    <input class="form-control form-control-sm map-filter mb-3"/>
                                </div>
                                <div class="dropdown-menu-items overflow-auto " style="max-height:30vh;">
                                    #drop-down-menu-items#
                                </div>
                            </div>
                          </div>
                        </div>
                    </div>`,e.forEach(n=>{u+=s.replace("#filedName#",n.value).replace(/#fieldId#/g,n.value);var t="",f=i[n.value.substr(1)];$pinc.isNullOrEmpty(f)||(t=r(f));u=u.replace("#mappedItems#",t)})),n!=null?(o=[],t(o,n,"/"),f="",h=`<a class="dropdown-item cursor-pointer d-flex justify-content-between overflow-auto" data-item="#fieldName#">
                                            <div >#fieldName#</div>
                                            <div class="text-muted text-right" style="max-width:30%;overflow:hidden;text-overflow:ellipsis">#fieldValue#</div>
                                        </a>`,o.forEach(n=>{f+=h.replace(/#fieldName#/g,n.value),f=f.replace(/#fieldValue#/g,(n.display||"").replace(/</g,"&lt;"))}),u=u.replace(/#drop-down-menu-items#/g,f)):u.replace(/#drop-down-menu-items#/g,""),u}function r(n){return`<div class="rounded text-xs d-inline-block mr-2 border panel-section-bg-color map-item overflow-hidden" style="margin-top:-2px" >
                                    <div class="d-flex align-items-center">
                                        <div class="border-right p-1 panel-hover-bg-color remove-map-item" >
                                            <i class="fal fa-times cursor-pointer "></i>
                                        </div>
                                        <div class="flex-grow-1 p-1 map-item-text font-weight-bold">${n}</div>
                                    </div>
                                </div>`}function t(n,i,r){for(var u in i)Array.isArray(i[u])?t(n,i[u][0],`${r}${u}[]/`):typeof i[u]!="object"?n.push({value:`${r}${u}`,display:i[u]}):t(n,i[u],`${r}${u}/`)}var u=this,n;this.html=`<div data-name="{{name}}" data-input-type="jsonMap" data-input-size="{{inputSize}}" class="{{controlId}}" data-control-id="{{controlId}}"><div class="field-map ">#field-map#</div></div>`;this.initialize=function(n,t){return t.default==null&&(t.default={source:null,output:null}),n.replace("#field-map#",i(t.default.source,t.default.output))};n=n=>{var t=$pincj(n).closest("[data-control-id]");return t.length==0&&(t=$pincj(n).find("[data-control-id]")),t};this.refresh=(t,r)=>{var f=n(t),e;r.inputSize=f.data().inputSize;e=$pinc.dataReplace(i(r.source,r.target),r,!1,!0);f.find(".field-map").html(e);u.bind(t)};this.bind=t=>{var i=n(t);i.find(".dropdown-menu .dropdown-item").on("click",n=>{var t=$pincj(n.target).closest("[data-item]"),u,f;if(!(t.length>0)){u=t.attr("data-item");f=i.find(".selected-map-items");f.append(r(u));i.find(".remove-map-item").unbind();i.find(".remove-map-item").on("click",n=>{n.preventDefault(),n.stopPropagation(),$pincj(n.target).closest(".map-item").remove()})}});i.find(".map-drop-down").unbind();i.find(".map-drop-down").on("show.bs.dropdown",n=>{setTimeout(()=>{$pincj(n.target).find(".map-filter")[0].focus()},200)});i.find(".map-filter").unbind();i.find(".map-filter").on("keyup",n=>{var t=$pincj(n.target).closest(".dropdown-menu"),i=$pincj(n.target).val();i==""?t.find(`[data-item]`).removeClass("d-none"):(t.find(`[data-item]`).addClass("d-none"),t.find(`[data-item*="${i}"]`).removeClass("d-none"))})};this.getHtml=i;this.value=t=>{var r=n(t),i={output:{}};return r.find(".map-field").each((n,t)=>{var u=$pincj(t).data().field.substr(1).split("/"),f=$pinc.trim($pincj(t).find(".map-item-text").text()),r=i.output;u.forEach((n,t)=>{var e=!1,i;n.indexOf("[]")>0&&(n=n.replace("[]",""),e=!0);t<u.length&&(r[n]={});e&&(i=f.split("/"),f="/"+i.pop(),r[n]._type="array",r[n]._source=i.join("/"));t==u.length-1?r[n]=f:r[n]==null&&(r[n]={});r=r[n]})}),i}};$pinc.forms=new function(){var n=this,i={ip:"^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])$"},r={},t;this.restInput=new function(){function h(n){if($pinc.isNullOrEmpty(n))return"";var t="",i=(n||"").split(",");return i.forEach(n=>{var i=n.split(";"),r="";$pinc.isNullOrEmpty(i[1])||(r+=` data-multi="${i[1]}"`);t+=`<a class="dropdown-item" ${r} href="#">${i[0]}</a>`}),`<div class="dropdown-menu text-sm" style="width:100%">${t}</div>`}function t(n,t,r,u,f){var e="",h={},c=4,o,s;for(o in t)h={key:o,value:t[o]},e+=i(h,u,f),c--;for(s=0;s<c;s++)e+=i(null,u,f);return e+=i(null,u,f),n.replace(r,e)}function i(n,t,i){var r=s.replace("#property-dropdown-items#",h(t));return r=r.replace("#value-dropdown-items#",h(i)),(n==null||n.key==null||n.value==null)&&(n=n||{},Object.assign(n,{key:n.key||"",value:n.value||""}),r=r.replace("invisible","")),n.value=n.value.replace(/\"/g,"&quot;"),$pinc.dataReplace(r,n,!1,!0)}function a(n){var t=r(n);return f[t.data().controlId]}function c(n){var r=n.data(),o=(r||{}).propertySource||"",s=(r||{}).valueSource||"",f=y(n),e="prow-"+$pinc.getGuid(),t={};return t.inputSize=f.data().inputSize,t.id=e,n.find(".property-table").append(i(t,o,s)),u(f),$pincj(`.${e}`)}function v(t){function u(){var t=app.personalizeProp("darkTheme");t==!0?n.instance.setOption("theme","abcdef"):n.instance.setOption("theme","default")}function f(n){var t=JSON.parse(n);return JSON.stringify(t,null,1)}var i="jse"+$pinc.getGuid().replace("-",""),r;n.$elJSE=t.find(`.form-json-editor`);n.$elJSE.prop("id",i);n.instance=CodeMirror.fromTextArea(document.getElementById(i),{matchBrackets:!0,autoCloseBrackets:!0,mode:"application/json",lineNumbers:!0,foldGutter:!0,lineWrapping:!1});r=$pincj(`#${i}`).parent()[0].getBoundingClientRect();n.instance.setSize(null,r.height);u();$pinc.events.on("app.personalize","dark",()=>{u()});n.instance.on("blur",()=>{try{var t=f(n.instance.getValue());n.instance.setValue(t)}catch(i){}})}function u(n){n.find(".list-property-input, .list-value-input").each((n,t)=>{var i=$pincj(t).closest(".dropdown"),r=i.find(".dropdown-menu");r.length==0&&$pincj(t).attr("data-toggle",null)});n.find(".list-property-input, .list-value-input").on("keydown",n=>{var t=$pincj(n.target).closest(".dropdown"),i=t.find(".dropdown-menu");i.removeClass("show")});n.find(".list-property .dropdown-item,.list-value .dropdown-item").unbind();n.find(".list-property .dropdown-item,.list-value .dropdown-item").on("click",b);n.find(".fa-times-circle").on("click",p)}function y(n){return n.closest(`[data-input-type="rest"]`)}function p(n){var t=$pincj(n.target).closest(".object-row");t.find(".list-property-input").val("");t.find(".list-value-input").val("")}function w(n){for(var t=n.closest(".object-row"),i=t.find(".list-property-input").val(),r=t.find(".list-value-input").val(),u=0;u<100;u++)if($pinc.isNullOrEmpty(i)&&$pinc.isNullOrEmpty(r))break;else if(t=t.next(),t.length==0){t=c($el.closest("[data-property-source]"));break}else i=t.find(".list-property-input").val(),r=t.find(".list-value-input").val();return t}function b(n){var i=$pincj(n.target).closest(".dropdown-item"),t=i.closest(".dropdown"),u=i.data()||{},r;$pinc.isNullOrEmpty(u.multi)?(t.find("[data-toggle]").val(i.text()),t.find("[data-toggle]")[0].focus()):(r=u.multi.split("|"),r.forEach(n=>{var i=n.split(":")[0],u=n.split(":")[1]||"";$row=r.length>1?w(t):t.closest(".object-row");$row.find(".list-property-input").val(i);$row.find(".list-value-input").val(u)}))}function k(n){var t=n;try{return typeof t=="string"&&(t=JSON.parse(t)),JSON.stringify(t,null,1)}catch(i){return typeof n=="string"&&(n=$pinc.trim(n||""),n.indexOf("{")!=0&&n.indexOf("[")!=0&&(n=`"${n}"`)),n}}var l=this,f={},e=`<table class="qp-list property-table" style="width:100%">
                                            #list-qp#
                                        </table>`,o=` <table class="headers-list property-table" style="width:100%" >
                                            #list-headers#
                                        </table>`,s,n,r;this.html=`<div class="d-flex flex-column {{controlId}} full-height" data-input-type="rest" data-name="{{name}}" data-input-size="{{inputSize}}" data-control-id="{{controlId}}">
                            <div class="d-flex align-items-center">
                                <select class="form-control  form-control-{{inputSize}} mr-2" required data-value="{{method}}" data-rest-name="method" style="max-width:6rem">
                                    <option value="POST" {{methodPOST}}>POST</option>
                                    <option value="GET" {{methodGET}}>GET</option>
                                    <option value="PATCH" {{methodPATCH}}>PATCH</option>
                                    <option value="PUT" {{methodPUT}}>PUT</option>
                                    <option value="DELETE" {{methodDELETE}}>DELETE</option>
                                    <option value="FORM" {{methodFORM}}>FORM POST</option>
                                    <option disabled>_________</option>
                                    <option value="GETFILE" {{methodGETFILE}}>FILE DOWNLOAD</option>
                                    <option disabled>_________</option>
                                    <option value="MULTIPART-FORM" {{methodMULTIPART-FORM}}>MULTIPART FORM POST</option>
                                    <option value="MULTIPART-FORM-PUT" {{methodMULTIPART-FORM-PUT}}>MULTIPART FORM PUT</option>
                                    <option value="MULTIPART-FORM-PATCH" {{methodMULTIPART-FORM-PATCH}}>MULTIPART FORM PATCH</option>
                                    <option disabled>_________</option>
                                    <option value="XML-POST" {{methodXML-POST}}>XML POST</option>
                                    <option value="XML-PUT" {{methodXML-PUT}}>XML PUT</option>
                                    <option value="XML-PATCH" {{methodXML-PATCH}}>XML PATCH</option>
                                </select>
                                <div class="input-group input-group-{{inputSize}}">
                                    <input type="url" value="{{url}}" required class="form-control  flex-grow-1" data-rest-name="url" placeholder="https://api.domain.com/rest/endpoint"/>
                                    <div class="input-group-append {{responseOn}}">
                                        <button class="btn btn-secondary send-button" style="cursor:pointer" type="button">{{responseControls}}</button>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-grow-1 pt-3 d-flex flex-column">
                                <ul class="nav nav-tabs text-xs d-flex ">
                                    <li class="nav-item">
                                        <a class="text-sm a nav-link" href="" data-toggle="tab" data-target=".{{controlId}} .headers-content">
                                            Headers
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="text-sm a nav-link" href="" data-toggle="tab"  data-target=".{{controlId}} .qp-content">
                                            Query Params
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="text-sm a nav-link active" href="" data-toggle="tab"  data-target=".{{controlId}} .body-content">
                                            Body
                                        </a>
                                    </li>
                                    <li class="nav-item ml-auto response-tab {{responseOn}}">
                                        <a class="text-sm a nav-link response-tab" href="" data-toggle="tab"  data-target=".{{controlId}} .response-content">
                                            Response
                                        </a>
                                    </li>

                                </ul>
                                <div class="tab-content d-flex pt-2 overflow-auto position-relative flex-grow-1">
                                    <div class="tab-pane flex-grow-1 headers-content " data-property-source="{{headerPropertyOptions}}" data-value-source="{{headerValueOptions}}" >
                                        <div class="d-flex flex-column full-height">
                                            <div class="headers-table flex-grow-1">
                                                ${o}
                                            </div>
                                            <div>
                                            <button class="btn btn-add-row btn-outline-secondary mt-1 btn-{{inputSize}}" data-target=".headers-list" >
                                                <i class="fas fa-plus-circle cursor-pointer px-2"></i>Add row
                                            </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane flex-grow-1 qp-content" data-property-source="{{queryPropertyOptions}}" data-value-source="{{queryValueOptions}}">
                                        <div class="d-flex flex-column full-height">
                                            <div class="qp-table flex-grow-1">
                                                ${e}
                                            </div>
                                            <div>
                                            <button class="btn btn-outline-secondary btn-add-row mt-1 btn-{{inputSize}}" data-target=".qp-list" >
                                                <i class="fas fa-plus-circle cursor-pointer px-2"></i>Add row
                                            </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane flex-grow-1 show active body-content" >
                                        <div class="d-flex full-height">
                                            <div class="flex-grow-1 full-height text-{{inputSize}}">
                                                <textarea class="form-json-editor" spellcheck="false" data-rest-name="payload"></textarea>
                                            </div>
                                            <!--pre class="text-sm json-body-editor overflow-auto border rounded flex-grow-1 body-content-input" spellcheck="false" data-rest-name="payload"></pre-->
                                        </div>
                                    </div>
                                    <div class="tab-pane flex-grow-1 response-content" >
                                        <div class="d-flex">
                                            <textarea readonly spellcheck="false" class="form-control form-control-{{inputSize}} flex-grow-1 response-content-input" style="height:19rem" data-rest-name="response"></textarea>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div> `;s=`<tr class="object-row {{id}}">
                                <td width="30%">
                                    <div class="dropdown list-property" >
                                        <input spellcheck="false" placeholder="Property" value="{{key}}" class="form-control form-control-{{inputSize}} list-property-input" data-toggle="dropdown"/>
                                            #property-dropdown-items#
                                    </div>
                                </td>
                                <td class="d-flex">
                                    <div class="dropdown list-value flex-grow-1" >
                                        <input spellcheck="false" placeholder="Value" value="{{value}}" class="form-control form-control-{{inputSize}} list-value-input" data-toggle="dropdown"/>
                                            #value-dropdown-items#
                                    </div>
                                    <i class="fal fa-times-circle input-group-text hover-opacity align-items-center cursor-pointer"></i>
                                </td>
                            </tr>`;n={};this.initialize=function(n,i){f[i.controlId]=i;var r={url:"",method:"POST",headers:{},queryString:{},payload:{}};return i.default!=null?typeof i.default=="string"&&(i.default=JSON.parse(i.default)):i.default={},Object.assign(r,i.default),r.payload=JSON.stringify(r.payload,null,4),i.headerPropertyOptions=i.headerPropertyOptions||"",i.headerValueOptions=i.headerValueOptions||"",i.queryPropertyOptions=i.queryPropertyOptions||"",i.queryValueOptions=i.queryValueOptions||"",n=t(n,r.headers,"#list-headers#",i.headerPropertyOptions,i.headerValueOptions),n=t(n,r.queryString,"#list-qp#",i.queryPropertyOptions,i.queryValueOptions),i.responseOn=$pinc.isNullOrEmpty(i.responseControls)!=!0?"":"d-none",r[`method${r.method.toUpperCase()}`]="selected",n=$pinc.dataReplace(n,r,!1,!0),$pinc.dataReplace(n,i,!1,!0)};r=n=>{var t=$pincj(n).closest("[data-control-id]");return t.length==0&&(t=$pincj(n).find("[data-control-id]")),t};this.bind=(n,t)=>{if(n.find(`[data-input-type="rest"]`).length!=0){n.find(".btn-add-row").on("click",t=>{t.stopPropagation(),t.preventDefault(),c($pincj(t.target).closest("[data-property-source]"),n)});var i=n.find(".list-property-input, .list-value-input");i.find(".list-property-input, .list-value-input").on("focus",n=>{var r=$pincj(n.target),t=r.closest(".dropdown"),i=t.find(".dropdown-menu");i.length>0&&(i.hasClass("show")||t.find(".data-toggle").dropdown())});u(n);v(n);n.find(".send-button").on("click",()=>{var i=l.value(n),r;$pinc.modals.loading("Processing...");$pinc.isNullOrEmpty(i.url)||(r=new URL(`${$pinc.environment.labsHost}utilities/rest`),$pincj.post(r,JSON.stringify(i)).always(i=>{var r=n.find(".response-content-input"),u;r.val(JSON.stringify(i,null,4));u=r.closest("[data-name]").attr("data-name");n.find(".response-tab").click();$pinc.events.fire(`${t}.${u}.response`,"change",{value:i});$pinc.modals.loading()}))})}};this.value=(i,f)=>{function v(n,t){n.find(".object-row").each((n,i)=>{var r=$pincj(i).find(".list-value-input").val(),u=$pincj(i).find(".list-property-input").val();$pinc.isNullOrEmpty(u)||$pinc.isNullOrEmpty(r)||(t[$pincj(i).find(".list-property-input").val()]=$pincj(i).find(".list-value-input").val())})}var h=r(i),c=a(i),s,l;if(f==null){s={url:"",method:"POST",headers:{},queryString:{},payload:"{}"};i.find("[data-rest-name]").each((t,i)=>{var r=$pincj(i).data().restName;s[r]=r=="payload"?n.instance.getValue():$pincj(i).val()});try{s.payload=JSON.parse(s.payload)}catch(y){delete s.invalidPayload;$pinc.isNullOrEmpty(s.payload)||(s.invalidPayload=s.payload);s.payload={}}return v(h.find(`.headers-content`),s.headers),v(h.find(`.qp-content`),s.queryString),s}i.find("[data-rest-name]").each((t,i)=>{var u=$pincj(i).data().restName,r;if(f[u]!=null)if(u=="payload"){r=f[u];try{typeof r=="string"&&(r=JSON.parse(r))}catch(e){}n.instance.setValue(k(r));$pincj(i).val(JSON.stringify(r,null,4))}else typeof f[u]!="object"&&$pincj(i).val(f[u])});l=t(e,f.queryString,"#list-qp#",c.queryPropertyOptions,c.queryValueOptions);h.find(`.qp-table`).html(l);l=t(o,f.headers,"#list-headers#",c.headerPropertyOptions,c.headerValueOptions);h.find(`.headers-table`).html(l);u(i)}};t={text:{html:`<div class="input-group input-group-{{inputSize}}">
                            <input spellcheck="false" data-name="{{name}}" name="{{name}}" readonly required type="text" placeHolder='{{placeHolder}}' value="{{default}}" data-validate={{validation}} class="form-control"/>
                            <div class="input-group-append {{copy}}">
                                <button class="btn btn-secondary copy-button" style="cursor:pointer">Copy</button>
                            </div>
                        </div>`},url:{html:`<input spellcheck="false" data-name="{{name}}" name="{{name}}" readonly required type="url" placeHolder='{{placeHolder}}' value="{{default}}" data-validate={{validation}} class="form-control form-control-{{inputSize}}"/>`},long:{html:`<textarea spellcheck="false" rows="5" data-name="{{name}}" name="{{name}}" readonly required class="form-control form-control-{{inputSize}}"  data-validate={{validation}} placeHolder='{{placeHolder}}'>{{default}}</textarea>`},number:{html:`<input spellcheck="false" data-name="{{name}}" name="{{name}}" readonly required type="number" class="form-control form-control-{{inputSize}}" value="{{default}}" data-validate={{validation}} placeHolder='{{placeHolder}}'/>`},email:{html:`<input spellcheck="false" data-name="{{name}}" name="{{name}}" readonly required type="email" class="form-control form-control-{{inputSize}}" value="{{default}}" data-validate={{validation}} placeHolder='{{placeHolder}}'/>`},dropdown:{html:`<select data-name="{{name}}" name="{{name}}" readonly required class="form-control form-control-{{inputSize}}" value="{{default}}" data-validate={{validation}}>{{optionList}}</select>`,optionsHtml:`<option value="{{value}}" {{selected}}>{{option}}</option>`,selectedHtml:"selected"},radio:{html:`<div data-name="{{name}}" name="{{name}}" data-input-type="radio" readonly required >{{optionList}}</select>`,optionsHtml:`<div class="radio"><label class="text-{{inputSize}} d-flex align-items-center"><input type="radio" name="optradio" value="{{value}}" {{selected}}><span class="mx-2">{{option}}</span></label></div>`,selectedHtml:"checked"},date:{html:`<input data-name="{{name}}" name="{{name}}" readonly required type="date" class="form-control form-control-{{inputSize}}" value="{{default}}" data-validate={{validation}} placeHolder='{{placeHolder}}'/>`},label:{html:`<div>{{default}}</div>`},rest:{html:n.restInput.html},jsonMap:{html:$pinc.jsonMap.html}};this.html=function(i){var e=$pinc.getGuid(),s,u,h;r[e]=i;var c=`<label style="font-weight:bold" class="control-label text-{{inputSize}}">{{label}}#labelHelp#</label>`,l=`<i data-toggle="popover" data-content="{{labelHelp}}" class="text-info text-{{inputSize}} ml-2 fal fa-question-circle cursor-pointer"></i>`,f={},o="";(i.tabs||[]).length>0?(o=`<ul class="nav nav-tabs form-nav-tabs">`,i.tabs.forEach((n,t)=>{o+=`<li class="nav-item"><a class="text-sm a nav-link ${t==0?" active":""}" data-toggle="tab" href="" data-target="#${n.id}-${e}" role="tab" >${n.display}</a></li>`,f[n.id]=`<div class="tab-pane fade ${t==0?"show active":""} " id="${n.id}-${e}"><div class="row">`}),o+=`</ul>`):f.general=`<div class="full-height"><div class="row full-height">`;s=`<small class="form-text text-muted">{{help}}</small>`;u="";$pinc.isNullOrEmpty(i.header)||(u+=`<div class="form-header form-text text-muted mt-0 mb-4" style="font-size:.8rem;line-height:1rem" >
            ${i.header}
        </div>`);i.inputSize=i.inputSize=="small"?"sm":"";$pinc.isNullOrEmpty(o)||(u+=o);i.fields.forEach(function(r){var o=r.tab||"general",u="",h,a;r.inputSize=i.inputSize;r.default=r.default=="pfx_undefined"?"":r.default;$pinc.isNullOrEmpty(r.label)||(u+=c);u=u.replace("#labelHelp#",$pinc.isNullOrEmpty(r.labelHelp)?"":l);r.type=r.type||"text";u+=t[r.type].html;r.className=(r.className||"").indexOf("col-")>=0?r.className:r.className+" col-12";r.formId=e;r.controlId="control_"+$pinc.getGuid();switch(r.type){case"rest":f[o]+=$pinc.dataReplace(`<div class="form-group {{className}}" >${n.restInput.initialize(u,r)}</div>`,r,!1);break;case"jsonMap":f[o]+=$pinc.dataReplace(`<div class="form-group {{className}}" >${$pinc.jsonMap.initialize(u,r)}</div>`,r,!1);break;default:h=t[r.type].optionsHtml;a=t[r.type].selectedHtml;r.optionList="";(r.options||[]).forEach(function(n){var t="";n.value==r.default&&(t=a);n.selected=t;r.optionList+=$pinc.dataReplace(h,n,!1,!0)});$pinc.isNullOrEmpty(r.help)||(u+=s);r.placeHolder=r.placeHolder||"";r.default=r.default||"";r.colSpan=r.colSpan||1;r.readOnly!=!0&&(u=u.replace("readonly",""));r.required==!1&&(u=u.replace("required",""));r.copy!=!0&&(r.copy="d-none");f[o]+=$pinc.dataReplace(`<div class="form-group {{className}}" >
                                            ${u}
                                            <div class='invalid-feedback'>
                                                ${r.error||"Invalid "+r.label}
                                            </div>
                                    </div>`,r,!1)}});u+=`<div class="tab-content d-block full-height" data-form-id="${e}">`;for(h in f)u+=f[h]+"<\/div><\/div>";return u+=`</div>`,$pinc.isNullOrEmpty(i.saveButton)||(u+=`<div class="d-flex justify-content-end">
                        <button class="btn btn-primary btn-submit btn-{{inputSize}}" type="submit" style="min-width:100px">
                            ${i.saveButton}
                        </button>

                    </div>`),u.replace(/{{inputSize}}/g,i.inputSize)};this.initialize=function(t,i){var r=n.html(t);i.html(r);n.bind(i)};this.bind=function(t,i){var u=t.find("[data-form-id]").attr("data-form-id"),e=r[u],f;if(n.restInput.bind(t,u),$pinc.jsonMap.bind(t,u),e.fields.forEach(n=>{n.on!=null&&n.on.forEach(i=>{$pinc.events.on(`${u}.${i.object}`,i.event,i=>{var i={source:i.value,target:n.default.output};n.type=="jsonMap"&&$pinc.jsonMap.refresh(t.find(`[data-name="${n.name}"]`),i)})})}),setTimeout(()=>{try{t.find("form .form-control")[0].focus()}catch(n){}t.find(".copy-button").on("click",n=>{n.preventDefault();n.stopPropagation();var t=$pincj(n.target).closest(".input-group"),i=t.find("input").val();$pinc.copy(i);$pinc.elMessage({dock:"bottomIn",classes:"text-sm rounded bg-dark text-white p-3 m-2",styles:"max-width:300px",message:t.data().copyMessage||"Copied"})})},300),f=t.find("form .btn-submit"),f.length>0)t.find("form").on("submit",()=>{i=i||{};var r=n.val(t);return r.valid&&i.submit!=null&&i.submit(r.data),!1});t.find("form .btn-reset").on("click",n=>{$pincj(n.target).closest("form")[0].reset()})};this.val=(t,r)=>{var e=t.find("[data-name]"),f={},u=!0;return e.each(function(t,e){var s=$pincj(e).data(),o="",c,l,h;if(r==null){switch(s.inputType){case"rest":o=n.restInput.value($pincj(e));break;case"jsonMap":o=$pinc.jsonMap.value($pincj(e));break;case"radio":o=$pincj(e).find("input:radio:checked").val();break;default:o=$pincj(e).val();c=s.validate;$pincj(e).removeClass("is-invalid");$pincj(e).prop("required")==!0&&$pinc.isNullOrEmpty(o)&&(u=!1,e.valid=null,e.invalid=!0,$pincj(e).addClass("is-invalid"));i[c]!=null&&(l=new RegExp(i[c],"i"),o.match(l)||(u=!1,e.valid=null,e.invalid=!0,$pincj(e).addClass("is-invalid")))}f[s.name]=o}else{if(h=r[s.name],h==null)return;switch(s.inputType){case"rest":n.restInput.value($pincj(e),h);break;case"radio":break;default:$pincj(e).val()(h)}}}),{data:f,valid:u}}};$pinc.events.fire("$pinc.forms","ready");$pinc.modals=new function(){function t(n,t,i){var e=u.replace("#body#",n).replace("#popupName#",t),f=`#${t}`,r;return i&&$pincj(f).remove(),r=$pincj(f),r.length==0&&($pincj(document.body).append(e),r=$pincj(f)),r.addClass("pinc-ui"),r}function r(t,i){i!=null&&(t.find(".modal-footer").html(""),i.forEach(function(i){var e=$pinc.getGuid(),u=n.buttonTemplate.replace(/#id#/g,e),f,o,r;for(f in i)o=new RegExp("#"+f+"#","gi"),u=u.replace(o,i[f]);if(t.find(".modal-footer").append(u),r=$pincj("#"+e),i.type=="close"&&r.attr("data-dismiss","modal"),i.type=="submit"&&r.attr("type","submit"),i.callback!=null)if(i.type=="submit")r.closest("form").on("submit",function(){return setTimeout(function(){var n=i.callback()!=!1;n&&$pinc.popups.hide({element:t})},300),!1});else r.on("click",i.callback)}))}var n=this,f;this.buttonTemplate='<button id="#id#" type="button" class="btn #class# btn-sm text-md btn-type-#type#" autofocus>#name#<\/button>';this.progress=function(n){$a=$pincj("#loading-popup");$progress=$a.find(".body-message .loading-progress");$progress.length==0&&($pinc.modals.loading({message:"<div style='width:400px;max-width:40vw;overflow:hidden;background-color:#EFEFEF' class='rounded-sm '><div class='bg-primary loading-progress rounded-sm' style='height:10px;transition:all .15s linear;width:1px;'  ><\/div><\/div>",showAnimation:!1}),$progress=$a.find(".body-message .loading-progress"));$progress.css("width",n.progress+"%")};n.state={loading:{allowHide:!1,visible:!1}};var u=`<div id="#popupName#" class="pinc-popup">
            <div class="pinc-popup-dialog  pinc-popup-dialog-centered">
                <div class="pinc-popup-content bg-white animated fadeInDown">#body#</div></div></div>`,i=`<div class="modal-footer"></div>`,e=`<button type="button" class="btn btn-sm text-md">Close</button>`;this.window=function(n){var f="",u;return n.noClose==!0&&(f="border-radius:8px;"),u=t(`<div class="modal-body d-flex" style="position:relative;overflow:hidden;border-top-left-radius:8px;${f}border-top-right-radius:8px;max-width:${n.maxWidth||"80vw"};width:${n.width||"500px"};height:${n.height||"60vh"}">
                        <iframe src="${n.src}" formborder="none" class="flex-grow-1" style='border:0px;padding:0px'></iframe>
                    </div>${n.noClose==!0?"":i}`,"window-popup",!0),n.noClose!=!0&&(n.buttons=[{name:"Close","class":"btn-primary",type:"close"}]),r(u,n.buttons),$pinc.popups.show({element:u,onclose:n.callback}),u};f=0;this.loading=function(i){function u(){return n.state.allowhide}i==null&&(i={});typeof i=="string"&&(i={message:i});var r=t(`<div class="modal-body" style="position:relative;">
                                            <div class="body-message f-container p-0">
                                                <div><i class="fas fa-circle-notch fa-spin mr-2 text-40p"></i></div>
                                                <div class="loading-message"></div>
                                            </div>
                                        </div>`,"loading-popup");if(typeof i=="string"&&(i={message:i}),$pinc.isNullOrEmpty(i.message)){n.state.allowhide=!0;$pinc.popups.hide({element:r});n.state.loading.visible=!1;return}r.find(".loading-message").html(i.message);r.find(".body-message").addClass(i.bodyClasses||"m-5 justify-content-center align-items-center");i.showAnimation==!1?r.find(".fa-circle-notch").addClass("d-none"):r.find(".fa-circle-notch").removeClass("d-none");n.state.loading.visible||(n.state.loading.visible=!0,$pinc.popups.show({element:r,onclose:i.callback,beforeClose:u}))};this.success=function(n){n.header=n.header||"Success";n.message=`<div class="mt-3 d-flex flex-row position:relative">${'<div class="border border-success p-2" style="border-radius:100%; width:70px;height:70px;z-index: 1;font-size:2rem;align-items:center">                                <i style = "transition:all .3s linear;font-size:50px" class="text-success fa fa-check" ><\/i>                            <\/div>'}<div class="px-3 d-flex flex-column align-items-center justify-content-center">${n.message}</div></div>`;$a=$pinc.modals.alert(n);$a.find(".fa-check")[0].style.clipPath="inset(0px 100% 0px 0px)";setTimeout(function(){$a.find(".fa-check")[0].style.clipPath="inset(0px)"},500)};this.buildFormHTML=n=>$pinc.forms.html(n);this.dateFilter=function(t){t.form={fields:[{name:"from",label:"Between",type:"date",className:"col-6","default":$pinc.formatDate("yyyy-mm-dd",new Date)},{name:"to",label:"To",type:"date",className:"col-6","default":$pinc.formatDate("yyyy-mm-dd",(new Date).addDays(1))},{name:"label","default":`<div class="d-flex justify-content-center my-3 border-top font-weight-bold position-relative">
                                    <div class="position-absolute text-center" style="top:-.85rem;left:0px;width:100%"><span class="bg-white px-2">OR</span></div>
                                </div>`,type:"label",className:"col-12 my-0"},{name:"pickRange",label:"Pick a Range",type:"dropdown",className:"col-12",options:[{value:"0,1",option:"Today"},{value:"-1,1",option:"Since yesterday"},{value:"-2,1",option:"Last two days"},{value:"-5,1",option:"Last 5 days"},{value:"-7,1",option:"Last 7 days"}]}]};t.form.validate=n=>{delete n.data.pickRange};var u=n.form(t),i=u.find(`[data-name="from"]`),r=u.find(`[data-name="to"]`);u.find(`[data-name]`).unbind();u.find(`[data-name="from"],[data-name="to"]`).on("change",n=>{var u=$pincj(n.target).data(),t;u.name=="from"?(t=$pinc.formatDate("yyyy-mm-dd",new Date(i.val()).addDays(1)),$pinc.isNullOrEmpty(r.val())?r.val(t):new Date(i.val()).valueOf()>new Date(r.val()).valueOf()&&r.val(t)):(t=$pinc.formatDate("yyyy-mm-dd",new Date(r.val()).addDays(-1)),$pinc.isNullOrEmpty(i.val())?i.val(t):new Date(r.val()).valueOf()<new Date(i.val()).valueOf()&&i.val(t))});u.find(`[data-name="pickRange"]`).on("change",n=>{var t=$pincj(n.target).val();t=t.split(",");i.val($pinc.formatDate("yyyy-mm-dd",(new Date).addDays(parseInt(t[0]))));r.val($pinc.formatDate("yyyy-mm-dd",(new Date).addDays(parseInt(t[1]))))})};this.form=function(u){function s(){f.find("[data-toggle='popover']").popover("hide");u.onclose!=null&&u.onclose()}function h(){var n=$pinc.forms.val(f);return n.valid?u.form.validate!=null&&(u.form.validate(n),!n.valid)?!1:(u.callback(n.data),$pinc.popups.hide({element:f}),!1):!1}var o=$pinc.forms.html(u.form),f,e;u.buttons=[{name:`${u.form.saveText||"Save"}`,"class":"btn-primary",callback:h,type:"submit"}];u.allowClose!=!1&&u.buttons.push({name:"Cancel","class":"btn-secondary",type:"close"});f=t(`<form>
                    <div class="modal-header" ><span>${u.form.title||u.header}</span></div>
                    <div class="modal-body" style="width:${u.form.width||"600px"};max-width:80vw;overflow-x:hidden;max-height:70vh;height:${u.form.height||"auto"};overflow-y:auto">
                        <div class="body-message">
                            ${o}
                        </div>
                        <div>${u.form.footer||""}</div>
                    </div>
                    ${i}
                </form>`,"form-popup",!0);r(f,u.buttons);$pinc.popups.show({element:f,onclose:s});f.find("select").each((n,t)=>{$pincj(t).val($pincj(t).attr("data-value"))});$pinc.forms.bind(f);e=0;f.find(`a[data-toggle="tab"]`).on("show.bs.tab shown.bs.tab",n=>{try{var t=$pincj($pincj(n.target).data().target).find(">*")[0].offsetHeight,i=$pincj($pincj(n.target).data().target);t>e&&(e=t);i.css({height:e})}catch(r){}});n.state.form={element:f};try{f.find("[data-toggle='popover']").popover({html:!0})}catch(c){console.log("popovers not attached")}return f};this.formData=()=>$pinc.forms.val(n.state.form.element);this.prompt=function(n){function u(){return n.allowHide=!0,$pinc.popups.hide({element:i}),!1}var i,r;n.allowHide=n.allowHide==null?!0:n.allowHide;i=t(`
                                    <form>
                                        <div class="modal-header">${n.header}</div>
                                        <div class="modal-body" style="min-height:95px;min-width:50vw;">
                                            <div class="body-message text-${n.inputSize}"></div>
                                            <div class="body-input mt-2">
                                                <textarea class="alert-modal-input form-control form-control-${n.inputSize}" autofocus rows="${n.rows||3}"></textarea>
                                                <input type="text" class="alert-modal-input-small form-control form-control-${n.inputSize}" autofocus />
                                                <select class="alert-modal-select form-control form-control-${n.inputSize}" autofocus >
                                                </select>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-primary text-md task-ok btn-sm">Ok</button>
                                            <button type="button" class="btn btn-close btn-secondary text-md btn-sm" data-dismiss="modal">Cancel</button>

                                        </div>
                                    </form>`,"alert-prompt");n.inputType=n.inputType||"lg";i.find(".form-control").addClass("d-none");i.find(".form-control").val("");r=i.find(".alert-modal-input");n.inputType=n.inputType||"text";switch(n.inputType){case"sm":r=i.find(".alert-modal-input-small");break;case"select":r=i.find(".alert-modal-select");n.list.forEach(n=>{r.append(`<option value="${n.value}">${n.display||n.value}</option>`)})}r.removeClass("d-none");n.allowHide||(i.find(`[data-dismiss="modal"]`).remove(),r.attr("required",!0));$pinc.isNullOrEmpty(n.placeHolder)||i.find(".form-control").attr("placeholder",n.placeHolder);$pinc.isNullOrEmpty(n.default)||i.find(".form-control").val(n.default);i.find(".body-header").html(n.header);i.find(".body-message").html(n.message);i.find("form").unbind();i.find("form").on("submit",function(){if(n.callback==null)return u();try{n.callback(r.val())}catch(t){}return u()});$pinc.popups.show({element:i,beforeClose:()=>n.allowHide});setTimeout(function(){r[0].focus()},300)};this.alert=function(n){var u=t(`
                    <div class="modal-header" ></div>
                    <div class="modal-body" style="min-width:450px;">
                        <div class="body-message rounded">
                            <div class="alert-message"></div>
                        </div>
                    </div>${n.noClose==!0?"":i}`,"alert-popup",!0);return u.css({"z-index":$pinc.environment.highestZIndex}),u.find(".modal-header").html(n.header),u.find(".alert-message").html(n.message),u.find(".body-message").addClass(n.bodyClasses||""),n.header==null&&u.find(".modal-header").addClass("d-none"),n.buttons==null&&n.noClose!=!0&&(n.buttons=[],n.buttons.push({name:"Close","class":"btn-primary",type:"close"})),r(u,n.buttons),$pinc.popups.show({element:u,onclose:n.callback}),u};this.error=function(n){var u=t(`
                    <div class="modal-header">
                        <div>
                            <i class="fas fa-exclamation-triangle pr-2 text-danger"></i>
                            <span class="modal-header-text"></span>
                        </div>
                    </div>
                    <div class="modal-body" style="min-height:95px;min-width:450px;max-width:600px">
                        <div class="body-message"></div>
                    </div>${i}`,"error-poup");u.find(".modal-header-text").html(n.header);u.find(".body-message").html(n.message);n.buttons==null&&(n.buttons=[],n.buttons.push({name:"Close","class":"btn-primary",type:"close"}));r(u,n.buttons);$pinc.popups.show({element:u,onclose:n.callback});setTimeout(()=>u.find(".btn-primary")[0].focus(),1e3)};this.confirm=function(n){function r(){try{n.callback(!0)}catch(t){}}var i=t(`
            <div class="modal-header"></div>
            <div class="modal-body">
                <div class="body-message"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary btn-sm text-md task-yes" data-dismiss="modal">Yes</button>
                <button type="button" class="btn btn-close btn-secondary btn-sm text-md" data-dismiss="modal" autofocus>No</button>
            </div>
        `,"confirm-popup");i.find(".modal-header").html(n.header);i.find(".body-message").html(n.message);i.find(".task-yes").unbind();i.find(".task-yes").on("click",r);i.find(".btn-close").unbind();i.find(".btn-close").on("click",n.cancelCallback);$pinc.popups.show({element:i})};$pinc.events.fire("$pinc.modals","ready")};$pinc.elMessage=function(n){function s(){t.on("animationend",()=>{t.remove()});t.addClass(u[n.dock].animateOut)}var f,o,t,r,e;n.autoHide==null&&(n.autoHide=!0);n.type==null&&(n.type="alert");n.allowHide==null&&(n.allowHide=!0);n._elDocked=n.selector!=null;n.selector==null&&(n.selector=document.body);n.dock==null&&(n.dock="topIn");n.classes==null&&(n.classes="");var h=`<div id="{{id}}" class="animated d-flex justify-content-between p-2 {{classes}}" style="left:0px;width:100%;z-index:3;{{styles}}">
                                <span class="flex-grow-1 {{mClasses}}">{{message}}</span>
                                <i class="fal fa-times close-message ${n.allowHide?"":"d-none"}" style="cursor:pointer"></i>
                            </div>`,u={topIn:{style:"top:0px;",animateIn:"fadeInDown",animateOut:"fadeOutUp"},bottomIn:{style:"bottom:0px",animateIn:"fadeInUp",animateOut:"fadeOutDown"}},i=$pincj(n.selector).find(`>.pinc-ui-multi-message-container`);i.length==0&&(f="position-absolute",n._elDocked&&(f=""),$pincj(n.selector).append(`<div class="pinc-ui-multi-message-container d-flex p-2 ${f} flex-column" style="width:100%;${u[n.dock].style};${n.additionalStyle}"></div>`),i=$pincj(n.selector).find(`>.pinc-ui-multi-message-container`));i.css({"z-index":$pinc.environment.highestZIndex++});$pincj(n.selector).css({position:"relative"});Object.assign(n,{id:$pinc.getGuid().replace(/\-/g,"")});n.classes+=" "+u[n.dock].animateIn;o=$pinc.dataReplace(h,n);i.append(o);t=$pincj(`#${n.id}`);t.find(".close-message").on("click",s);t.removeClass("d-none fadeOutUp");n.autoHide&&(r=5e3,e=n.message.split(" "),e.length>15&&(r+=e.length*400-r),setTimeout(s,r))};$pinc.webhookMonitor=function(n){function i(i){var r,u,e;try{if(i=JSON.parse(i),i.userId!=n.user_id)return;if(r=i.event,u=n.eventList.filter(n=>n.name==r),u.length==0){u=n.eventList.filter(n=>r.indexOf(n.name)==0);e=u[0].states.filter(n=>n.name==r)[0];r=u[0].name;var o=e.icon||"fa-check-circle text-success",s=$pincj(`#${t.currentId}`).find(`[data-monitor-event="${r}"]`),f=s.find(".monitor-event-status"),h=f.attr("data-icon")||"fa-spin fa-circle-notch";f.removeClass(h);f.addClass(o);f.attr("data-icon",o);s.find(`.monitor-event-display`).html(e.display)}else $pincj(`#${t.currentId}`).find(`[data-monitor-event="${r}"] .fa-circle-notch`).toggleClass("fa-circle-notch fa-spin fa-check-circle text-success")}catch(c){}}function r(n){if(!($pincj(`#${t.currentId}`).length>0)){var i=$pinc.getSessionId();$pinc.webSocket(n,i)}}var t=this;this.currentId;this.hide=()=>{try{$pincj(`#${t.currentId}`).parent().parent().remove()}catch(n){}};this.show=()=>{r(n.channel);t.currentId=`channel_monitor_${n.channel}`;$pincj(`#${t.currentId}`).length>0&&t.hide();var u=`<div id="${t.currentId}">`;n.eventList.forEach(n=>{u+=`<div class="monitor-event text-sm p-2" data-monitor-event="${n.name}"><i class="fa fa-circle-notch fa-spin monitor-event-status"></i> <span class="monitor-event-display">${n.display}</span></div>`});u+="<\/div>";$pinc.elMessage({message:u,autoHide:!1,dock:"bottomIn",classes:"rounded border panel-bg-color m-2 shadow",styles:"max-width:500px"});$pinc.events.off("$pinc.webSocket",`${n.channel}_message`,i);$pinc.events.on("$pinc.webSocket",`${n.channel}_message`,i)}};$pinc.oauth=new function(){function nt(){o=`${$pinc.environment.labsHost}integrate/command`;ot();$pinc.events.on("$pinc.oauth","integrations",rt);$pinc.events.fire("$pinc.oauth","load");$pinc.trace("EVENT fired: pinc.oauth.ready");$pinc.events.fire("$pinc.oauth","ready");at();tt();$pincj(window).on("unload",f)}function tt(){a("[data-oauth-command]:not([oauth-execution-mode='auto'])");$pinc.onNodesAdded(function(){a("[data-oauth-command]:not([oauth-execution-mode='auto'])")})}function it(){if($pinc.isNullOrEmpty(u)){if(u=$pinc.getGuid(),p=$pinc.sockets.addSocketToGroup(u),$pinc.environment.debug){$pinc.webSocket(u,"system@pathfix.com");$pinc.events.on("$pinc.webSocket",`${u}_message`,lt)}p.bind_global(b)}}function rt(){ft();return}function ut(n,i){i=i||function(){};var r=t=>{t.forEach(function(t){var r=`${n.clientId}_${t.name}`,i=h[r]||{},u;Object.assign(i,t);u=new URL(t.redirectURI||t.commandUrl||o);i.redirectURI=u.origin+"/integrate/command";i.clientId=i.clientId||i.id;$pinc.isNullOrEmpty(i.redirect_uri)||(i.redirectURI+=`/${i.clientId}`);i.scope=(t.scope||"").replace(/ /g,"+");h[r]=i}),i()},u={client_id:n.clientId,in_provider:n.providers||""};typeof $pinc.oauth.client!="undefined"?$pinc.oauth.client.connections({clientId:u.client_id,callback:r,userId:t(n)}):$pincj.get($pinc.environment.azHost+"azoauth/checkregistrationv1",u,function(n){r(n.rows)})}function a(i){$pincj(i).unbind();$pincj(i).each(function(i,r){$pincj(r).on("click",i=>{var u,f,e,o;($pinc.trace("pinc.oauth: _bindCommandButtons clicked"),i.stopPropagation(),i.preventDefault(),u=$pincj(r).attr("data-oauth-command"),u!=null)&&(u=u.split("."),f=$pincj(r).data(),e=f.oauthUserId,f.oauthUserId=="$pinc-oauth-virtual"&&(o=(new Date).valueOf().toString(),e=o.substr(o.length-6)+t()),n.processCommand({provider:u[0],method:u[1],clientId:f.clientId,userId:e,consentMode:f.oauthConsentMode||"popup"},!1))})})}function ft(){c("[data-oauth-ui]:not(.oauthuirendered)");$pinc.onNodesAdded(function(){c("[data-oauth-ui]:not(.oauthuirendered)")})}function et(){c("[data-oauth-ui]",!0)}function c(t,i){if(t=$pincj(t),t.length!=0){var r=()=>{a("[data-oauth-command]:not([oauth-execution-mode='auto'])")};$pinc.events.off("$pinc.oauth.client","display",r);$pinc.events.on("$pinc.oauth.client","display",r,!0,!0);t.each((t,r)=>{var e=$pincj(r),f,u;e.addClass(`oauthuirendered`);e.addClass("pinc-ui");f={container:e,switches:{}};u=e[0].dataset;(u.oauthUiSwitches||"").split(",").forEach(n=>f.switches[n]=!0);u.oauthClientId!=null&&(f.clientId=u.oauthClientId);u.oauthUserId!=null&&(f.userId=u.oauthUserId);$pinc.isNullOrEmpty(u.oauthUiProviders)||(f.filterByProviders=u.oauthUiProviders);$pinc.isNullOrEmpty(u.oauthUiProviderTypes)||(f.filterByProviderTypes=u.oauthUiProviderTypes);f.consentMode=u.oauthConsentMode||"popup";f.buttonColor=u.oauthButtonColor;f.iconSize=u.oauthIconSize;f.appearance=u.oauthUi;f.refresh=i;new n.client.display(f);e.addClass(`template-${f.appearance}`)})}}function ot(){var u=new URL(window.location),n=u.searchParams.get("oauthId"),t=$pinc.qs("provider"),r=()=>{var n=new URL(window.location);n.searchParams.delete("oauthId");n.searchParams.delete("provider");window.history.pushState({},"",n.href)},i;n==""||n=="undefined"?($pinc.events.fire("$pinc.oauth","notConsented",{provider:t}),r()):$pinc.isNullOrEmpty(n)?$pinc.events.fire("$pinc.oauth","consentRedirect",{}):(i={id:$pinc.qs("oauthId"),provider:t},s(t,"identity_user",JSON.stringify(i)),$pinc.events.fire("$pinc.oauth","consentRedirect",i),r())}function w(n){if(n==null)return null;var t=null;return e==null&&($pinc.trace("pinc.oauth:suppported integrations:"+r.length),e={},r.forEach(n=>{n.name=n.name||n.title,e[n.name]=n}),r.length==0)?(e=null,null):(t=e[n.toLowerCase()],t!=null&&t.consent==null&&(t.consent={mode:"redirect"}),t)}function st(n,t){var r=`${n.clientId}_${n.provider}`,i=h[r];if(i!=null)return t(i);ut({providers:n.provider,clientId:n.clientId},()=>{i=h[r],t(i)})}function ht(n){var u=y(n.provider).id,r=new URL(`${$pinc.environment.labsHost}oauth/method/${n.provider}/call`);if($pinc.isNullOrEmpty(u)){if($pinc.isNullOrEmpty(n.userId))return;r.searchParams.set("userId",n.userId||t())}else r.searchParams.set("oauthId",u);r.searchParams.set("pinc_client_id",i());$pincj.post(r,JSON.stringify(n.data)).always(n.callback)}function ct(t){var i,e,r,u;try{i=$pinc.oauth.client.applications(t).url;i=i.split("/").pop()==""?i:i+"/";e=/Mobi/gi.test(navigator.userAgent);e?n.__openWindow=window.open(`${i}integrate/start.html`):(r=g(),n.__openWindow=window.open(`about:blank`,"pathfix_oauth",`location=yes,height=${r.h},width=${r.w},left=${(window.screen.availWidth-r.w)/2},top=${(window.screen.availHeight-r.h)/2},scrollbars=yes,status=yes`),u=window.setInterval(function(){if(n.__openWindow==null)return window.clearInterval(u);try{n.__openWindow!=null&&n.__openWindow.closed!==!1&&(window.clearInterval(u),$pinc.events.fire("$pinc.oauth","notConsented",{provider:t.provider}))}catch(i){return window.clearInterval(u)}},200));n.__openWindow.addEventListener("message",()=>{})}catch(o){f()}}function i(n){n==null&&(n={});var i=window._pinc_oauth_clientId||$pinc.data.oauthClientId||$pinc.data.oauthPublicKey||$pinc.data.publicKey||$pinc.clientId,t=n.publicKey||n.clientId||i;if(!$pinc.isNullOrEmpty(t))try{return eval(t)}catch(r){return t}return t}function t(n){function i(n){try{return eval(n)}catch(t){return n}}n==null&&(n={});var t;return n.userId=n.userId||n.user_id,t=i(n.userId),$pinc.isNullOrEmpty(t)&&(t=i(document.getElementById("pinc.helper").getAttribute("data-user-id"))),$pinc.isNullOrEmpty(t)&&(t=i($pinc.data.userId)),t||""}function lt(n){n=JSON.parse(n);b(null,{type:n.type,message:JSON.stringify(n)})}function b(n,t){t.message!=null&&d(JSON.parse(t.message))}function f(){try{n.__openWindow.close();n.__openWindow=null}catch(t){}}function k(t){v[t.id]==null&&(v[t.id]="fired",n.consentInterrupt!=null?n.consentInterrupt(t):$pinc.events.fire("$pinc.oauth","consented",t))}function d(t){var i=l[t.ccId],u,r,h,e;switch(t.type){case"oauth.closeWindow":f();i.settings.oauthId!=null?k(t.data):$pinc.events.fire("$pinc.oauth","notConsented",t.data);break;case"oauth.consented":f();t.data.userId=i.settings.userId;n.clearCachedUserState(i.settings.pinc_client_id,i.settings.userId);k(t.data);s(t.data.provider,i.settings.userId,JSON.stringify(t.data));break;case"oauth.commandComplete":f();t.data.provider=i.settings.provider;$pinc.events.fire("$pinc.oauth","command",t.data);i.settings.autoConsentMode==!0&&$pinc.events.fire("$pinc.oauth","autologin",t.data);break;case"oauth.form":i.frame[0].style.cssText="position:fixed;top:0px;left:0px;width:100vw;height:100vh;display:block;border:0px";break;case"oauth.form.close":i.frame[0].style.cssText="display:none";break;case"oauth.consentneeded":if(i.settings.autoConsentMode){$pinc.events.fire("$pinc.oauth","autologinfail",i.settings.provider);return}u=new URL(o.replace("#provider#",i.settings.provider));r=JSON.parse(JSON.stringify(i.settings));r.autoConsent=!0;r.referrer=window.location.href;for(h in r)$pinc.isNullOrEmpty(r[h])||u.searchParams.set(h,r[h]);s(i.settings.provider,i.settings.userId,null);r.authenticateByRedirect==!0?window.location=u:n.__openWindow==null||n.__openWindow.window==null?(e=g(),n.__openWindow=window.open(u,"pathfix_oauth",`location=yes,height=${e.h},width=${e.w},left=${(window.screen.availWidth-e.w)/2},top=${(window.screen.availHeight-e.h)/2},scrollbars=yes,status=yes`)):setTimeout(()=>{n.__openWindow.location=u},500)}}function g(){var n=window.screen.availHeight*.6,t;return n>600&&(n=600),t=window.screen.availWidth*.6,t>700&&(n=700),{h:n,w:t}}function s(n,t,i){$pinc.isNullOrEmpty(t)&&(t="identity_user");$pinc.setCookie(`${n}_${t}_oauth`,i)}function y(n,t){return $pinc.isNullOrEmpty(t)&&(t="identity_user"),JSON.parse($pinc.getCookie(`${n}_${t}_oauth`)||"{}")}function at(){function i(t){try{r=t.rows||[];r.length>10&&(r.forEach(function(t){var i={name:t.name,label:t.label,type:t.type};n.providers.list.all[i.name]=i;i.type!="identity"?n.providers.list.nonIdentity[i.name]=i:n.providers.list.identity[i.name]=i}),$pinc.events.fire("$pinc.oauth","integrations"))}catch(i){console.error("Error in loading definitions")}}var t=$pinc.getCookie("oauth_resources");$pinc.isNullOrEmpty(t)||i(JSON.parse(t));$pincj.get($pinc.environment.azHost+"azoauth/resources").always(n=>{$pinc.setCookie("oauth_resources",JSON.stringify(n)),$pinc.isNullOrEmpty(t)&&i(n)})}var n=this,r,h={},e=null,v;_registrationsChecked=!1;var l={},u,p=null,o="";this.preconsent=!1;Object.defineProperty(n,"userId",{get:function(){return t()}});Object.defineProperty(n,"clientId",{get:function(){return i()}});Object.defineProperty(n,"publicKey",{get:function(){return i()}});this.providers={list:{all:{},identity:{},nonIdentity:{}},configuration:w};this.authorizedList=function(n,r){n=n||t();var u={user_id:n,client_id:i()};$pincj.get(`${$pinc.environment.azHost}azoauth/providersauthorized`,u,n=>{var t=n.rows||[];r!=null&&r(t)})};this.clearCachedUserState=function(n,t){$pinc.setCookie(`${n}_${t}`,null)};this.revoke=function(r,u,f,e){e==null&&(e=!0);u=u||t();f=i({clientId:f});var o=$pinc.getPathfixRevokeUrl(r,f,u);s(r,u,null);n.clearCachedUserState(f,u);$pincj.get(o).always(()=>{e&&setTimeout(()=>{$pinc.events.fire("$pinc.oauth","revoked",{provider:r,userId:u})},300)})};this.authorized=function(n,r,u){function h(t){t=t.rows[0].data;t.authorized!="no"&&(e=!0);u!=null&&u(e,n)}var e=!1,f,o,s;return r=r||t(),f={provider:n,user_id:r,client_id:i()},f.pinc_client_id=f.client_id,o=y(n,r).id,r=="identity_user"?$pinc.isNullOrEmpty(o)?u(!1):u(!0):(s=new URL(`${$pinc.environment.labsHost}oauth/connection/${n}`),$pincj.get(s,f).always(h)),e};this.getOauthId=y;this.bind=c;this.rebind=et;this.processCommand=function(r,e){function a(n){if(n!=null){var t=new URL(n);o=t.origin+"/integrate/command"}}function v(i){function v(){var f=$pinc.getGuid(),v,n,a;l[f]={settings:{}};v={};i.labsServer=$pinc.environment.labsHost;i.pincClientId=h;i.providerLabel=s.label;n=l[f].settings;a=new URL(o.replace("#provider#",r.provider));n.messageGroupId=u;n.method=r.method||"call";n.consentURL=$pinc.dataReplace(s.url,i,!1)+`&state=${f}.pathfix`;n.autoConsent=e&&s.consent.mode=="frame";n.autoConsentMode=e;n.authenticateByRedirect=c;c==!0&&(a=$pinc.data.authSuccessUrl||r.consentedRedirect,$pinc.isNullOrEmpty(a)&&(a=window.location.href),n.consented_action="redirect",n.consented_redirect=a);n.forceConsent=0;n.userId=t(r);n.oauthId=v.id||"";n.provider=r.provider;n.providerLabel=s.label;n.pinc_client_id=h;n.ccId=f;n.integrationType=s.type;n.onsuccess=$pinc.data.authSuccessUrl;d({type:"oauth.consentneeded",ccId:f})}if(a(i.commandUrl),it(),i==null){console.error(`Authorization Command Exiting! Did not find integration details for provider:${r.provider} and client:${clientId}`);return}if(n.preconsent==!0){var y={user_id:t(r),provider:r.provider,public_key:h};n.continueConsent=()=>{v(),n.continueConsent=null};n.cancelConsent=()=>{f(),n.cancelConsent=null};$pinc.events.fire("$pinc.oauth","preconsent",y)}else v()}var s,c,h;if(r.data!=null)return ht(r);if(s=w(r.provider),$pinc.trace("pinc.oauth: processCommand entry"),s==null){console.error(`Authorization Command Exiting! Did not find configuration for:${r.provider}`);return}$pinc.trace("pinc.oauth: providerConfig ok");c=s.type=="identity"||r.consentMode=="redirect";c||ct(r);h=i(r);st({provider:r.provider,clientId:h},v);n.continueConsent=()=>{};n.cancelConsent=()=>{}};this.getCommandClientId=i;this.getCommandUserId=t;v={};this.setOauthId=s;nt()};$pinc.oauth.client=new function(){function u(t){function i(){function e(n){r.conns=="yes"&&(i.integrations=n.connections||[],i.app=(n.app||[])[0]);r.auths=="yes"&&(t.authorizations=n.authorizations||[]);i.readyState="ready";t.readyState="ready";$pinc.events.fire("$pinc.oauth",`clientstate`,i);$pinc.trace(`firing event for clientstate_${t.key}`);$pinc.events.fire("$pinc.oauth",`clientstate_${t.key}`,i)}var r={user_id:t.userId,client_id:t.clientId,auths:"yes",conns:"yes"},i=n[t.clientId],u,f;(i.readyState=="initializing"||i.readyState=="ready"?r.conns="no":i.readyState="initializing",t.readyState!="initializing")&&(t.readyState="initializing",t.userId=="empty"&&(r.auths="no"),u=$pinc.getCookie(`${t.key}`),$pinc.isNullOrEmpty(u)||(f=JSON.parse(u),f.connections==null?u=null:e(f)),$pincj.get($pinc.environment.azHost+"azoauth/getuserstatev1",r).always(n=>{$pinc.trace("oauth.client.getuserstate","params.conns:"+r.conns);var i=JSON.parse(u||"{}");n.app!=null&&(i.app=n.app);n.authorizations!=null&&(i.authorizations=n.authorizations);n.connections!=null&&(i.connections=n.connections);$pinc.setCookie(`${t.key}`,JSON.stringify(i));$pinc.isNullOrEmpty(u)&&e(i)}))}$pinc.events.on("$pinc.oauth","integrations",i,!0,!0)}function t(t){var i=$pinc.oauth.getCommandClientId(t||{}),r=$pinc.oauth.getCommandUserId(t||{}),u=i+"_"+r;return t.userId=r,t.clientId=i,n[i]=n[i]||{integrations:[],readyState:"waiting",clientId:i,users:{}},n[i].users[r]=n[i].users[r]||{authorizations:[],clientId:i,userId:r,key:u,readyState:"waiting"},n[i]}function f(n,i){var f=t(n),r=f.users[n.userId];if(r.readyState=="initializing"){$pinc.trace("waiting for client app to initialize from previous initialization"+r.key);$pinc.events.on("$pinc.oauth",`clientstate_${r.key}`,i,!1,!0);return}if(n.refresh==!0||r.readyState=="waiting"){n.forceInitialize=!0;$pinc.events.on("$pinc.oauth",`clientstate_${r.key}`,i,!1,!0);return $pinc.setCookie(r.key,null),u(r)}if(r.readyState=="ready")$pinc.events.on("$pinc.oauth",`clientstate_${r.key}`,i,!0,!0)}var i=$pinc.oauth,n={};const r=(n,t)=>{const[i,r]=n.length<t.length?[n,t]:[t,n];return i.some(n=>r.includes(n))};this.applications=function(n){return(t(n)||{app:{url:$pinc.environment.labsHost}}).app};this.connections=function(n){function u(){var e=t(n),f=[],o=e.app||[]||{},u=e.integrations||[],s=e.users[n.userId].authorizations||[];return $pinc.trace("oauth.client","integrations configured: "+u.length),$pinc.isNullOrEmpty(n.filterByProviders)||(u=u.filter(t=>r(n.filterByProviders.split(","),t.provider.split(",")))),$pinc.isNullOrEmpty(n.filterByProviderTypes)||(u=u.filter(t=>{var u=i.providers.configuration(t.provider);return u==null?!1:r(n.filterByProviderTypes.split(","),u.type.split(","))?!0:!1})),u.forEach(t=>{var r=i.providers.configuration(t.provider),u,e;r!=null&&(r.label=t.title||r.label,r.description=t.description||`Connect your ${r.label} account`,u=s.filter(n=>n.provider==t.provider),$pinc.isNullOrEmpty(n.filterByUsers)||(u=u.filter(t=>{var i=n.filterByUsers.indexOf(`${r.name}/${t.user_id}`)>=0;return!i&&n.filterByUsers.indexOf("/")<0&&(i=n.filterByUsers.indexOf(`${t.user_id}`)>=0),i})),t.commandUrl=o.url,u.forEach(n=>{var i=Object.assign({},r);Object.assign(i,t);Object.assign(i,n);i.authorized=!0;f.push(i)}),u.length!=0||n.authorizedOnly||(e=Object.assign({},r),Object.assign(e,t),f.push(e)))}),n.callback!=null&&n.callback(f),f}return n=n||{},n.authorizedOnly=n.authorizedOnly||!1,n.refresh=n.refresh||!1,f(n,u)};this.connectionNames=(n,t)=>{$pincj.get(`${$pinc.environment.azHost}usermap/read`,{client_id:n.clientId,tenant_id:"B835E350-8C22-4F30-9E68-C59108B58160",user_id:n.userId}).always(n=>{t(n.rows||[])})}};$pinc.oauth.client.display=function(n){function h(n){var t=u.get(n);return t==null&&(i++,u.set(n,i)),i}function f(n,i){for(var r in t)t[r].refresh(n,i)}function o(n,t,i,r,u,f){$pincj.post(`${$pinc.environment.azHost}usermap/create`,JSON.stringify({name:u,client_id:n,tenant_id:"B835E350-8C22-4F30-9E68-C59108B58160",map_id:t,user_id:i,provider:r})).always(f)}var s=$pinc.oauth,e;$pinc.events.on("$pinc.oauth","ready",()=>{$pinc.oauth.consentInterrupt=n=>{f(n,!0)}},!0,!0);$pinc.events.on("$pinc.oauth","revoked",n=>f(n,!1));$pinc.uiLibrary();var t={},u=new Map,i=0;e=function(n){function a(n,t){try{var r=$pincj(i.container).data().oauthConsentPost;t||(r=$pincj(i.container).data().oauthRevokePost);$pinc.trace(r);$pinc.isNullOrEmpty(r)||(n.publicKey=i.publicKey,$pincj.post(r,JSON.stringify(n)).always(n=>{$pinc.trace(n)}))}catch(u){}}function v(){Object.assign(i,n);i.switches=i.switches||{};switches=i.switches;["authorizedOnly","multi","static","checkBoxes","unauthorizedOnly"].forEach(n=>{switches[n]=switches[n]!=null?switches[n]:!1});["disconnect","add","statusOn"].forEach(n=>{switches[n]=switches[n]!=null?switches[n]:!0});i.maxConnections=i.maxConnections||5;i.providerChecked=i.providerChecked||"";i.authorizedOnly=i.switches.authorizedOnly;i.unauthorizedOnly=i.switches.unauthorizedOnly;i.filterByProviders=(i.filterByProviders||"").toLowerCase();i.filterByProviderTypes=(i.filterByProviderTypes||"").toLowerCase();i.appearance=i.appearance||"list";i.color=i.buttonColor||"#007BFF";i.color_rgb=y(i.color);i.iconSize=i.iconSize=="Large"?"lg":"md"}function y(n){return n=n.replace("#",""),r=parseInt(n.substring(0,2),16),g=parseInt(n.substring(2,4),16),b=parseInt(n.substring(4,6),16),result=`${r},${g},${b}`}function f(){function f(t){if(r.find(">div").remove(),i.switches.multi?$pinc.oauth.client.connectionNames(i,n=>{u=n,w(i,t,r),c(),$pinc.events.fire("$pinc.oauth.client","display")}):(p(i,t,r),c(),$pinc.events.fire("$pinc.oauth.client","display")),n.refresh=!1,n.onDisplay!=null)n.onDisplay(t)}var r=$pincj(i.container);r.length!=0&&(t[h(r[0])]=l,r.html(""),i.callback=f,s.client.connections(i))}function p(n,t,i){function u(t){var u={name:t.name},o,s;(u.consentMode=n.consentMode,u.clientId=n.clientId,u.userId=n.userId,u.label=t.label,u.appearance=n.appearance,u.description=t.description,u.connectText=u.name.indexOf("google")==0?"Sign in with Google":"Connect",t.authorized!=r&&(o=r==null?"mt-0":"mt-4",r=t.authorized,r?i.append(`<div class="${o} mb-0 text-muted pinc-oauth-ui connection-group-header header-${u.appearance}">Connected Apps</div>`):i.append(`<div class="${o} mb-0 text-muted pinc-oauth-ui connection-group-header header-${u.appearance}" >Apps available for Integration</div>`)),i.append($pinc.dataReplace(e,u)),!n.authorizedOnly||t.authorized)&&(n.unauthorizedOnly&&t.authorized||(u.iconSize=n.iconSize,u.revokeOn=n.switches.disconnect?"":"d-none",u.showConnected=t.authorized&&n.switches.statusOn==!0?"d-flex":"d-none",u.showNotConnected=t.authorized?"d-none":n.switches.static==!1?"":"d-none",s=$pinc.dataReplace(f,u),i.find(`.${t.name}-connections`).append(s)))}var f=`<div data-provider="{{name}}"  
                                        data-oauth-consent-mode="{{consentMode}}"
                                        data-client-id="{{clientId}}" 
                                        data-oauth-user-id="{{userId}}" 
                                        class="c-item p-3  d-flex f-item align-items-start"  >
                                            <div class="d-flex py-2 flex-grow-1 p-name-group">
                                                <div class="mr-3">
                                                    <i class="icon-{{iconSize}} p-1 rounded bg-white c-item-icon" style="background-image:url('${$pinc.environment.imageHost}i/{{name}}-icon.png')"></i>
                                                </div>
                                                <div class="flex-grow-1 p-name-group-text">
                                                    <div style="line-height:1.25em;" class="c-item-label d-flex justify-content-between">
                                                        <div class="d-flex flex-column c-item-text">
                                                            <span style="font-weight:500;color:var(--pinc-oauth-ui-panel-text-color)">{{label}}</span>
                                                            <div class="mt-1 provider-description text-sm" style="color:var(--pinc-oauth-ui-panel-light-text-color)">{{description}}</div>
                                                        </div>
                                                        <div>
                                                            <button class="btn btn-sm btn-connect ml-3 {{showNotConnected}}"  
                                                                data-oauth-command="{{name}}.call" data-client-id="{{clientId}}" 
                                                                data-oauth-user-id="{{userId}}"
                                                                data-oauth-consent-mode="{{consentMode}}"
                                                                style="min-width:90px">
                                                                {{connectText}}
                                                            </button> 
                                                        </div>
                                                    </div>
                                                    <div class="{{showConnected}} mt-3">
                                                        <div class=" {{name}}-name text-sm" ></div>
                                                        <div class="text-sm text-success mr-2 d-flex align-items-center connected-info py-1 {{showConnected}}" >
                                                            <i class="fal fa-check-circle pr-1  " ></i>
                                                            Connected
                                                        </div>
                                                        <button class="btn hover-border rounded p-1 {{revokeOn}} d-flex align-items-center tool-revoke text-sm" style="color:var(--pinc-oauth-ui-panel-text-color)">
                                                            <i class="fal fa-minus-circle pr-1  " title="Disconnect" ></i>
                                                            <div>Disconnect</div>
                                                        </button>

                                                    </div>
                                                </div>
                                                
                                            </div>
                                    </div>`,e=`<div class="pinc-oauth-ui {{appearance}}">
                                            <div class="{{name}}-connections f-item f-container">
                                            </div>
                                        </div>`,o=`<style>
                                :root{
                                    --pinc-oauth-ui-panel-bg-color:#fff;
                                    --pinc-oauth-ui-panel-text-color:#000;
                                    --pinc-oauth-ui-panel-light-text-color:#6c757d;
                                    --pinc-oauth-ui-panel-hover-bg-color:#f8f9fa;
                                    --pinc-oauth-ui-panel-border-color:#dee2e6;

                                }
                                .pinc-oauth-ui.connection-group-header{
                                    font-size:1.2em;
                                }
                                .pinc-oauth-ui.connection-group-header.header-list-columns{
                                    grid-column:1/ -1;
                                }

                                .pinc-oauth-ui i.fas,.pinc-oauth-ui i.fad,.pinc-oauth-ui i.fal,.pinc-oauth-ui i.fa{
                                    font-style:normal
                                }

                                


                                .hover-bg:hover{background-color:var(--pinc-oauth-ui-panel-hover-bg-color) !important}
                                .template-list-panel{display:flex;flex-direction:column}
                                .template-list-columns{display: grid !important;grid-template-columns: repeat(auto-fill, minmax(280px,1fr));grid-gap: 26px;padding: 10px;grid-column-gap: 26px;}

                                .pinc-oauth-ui .c-item{background-color:var(--pinc-oauth-ui-panel-bg-color);}

                                .pinc-oauth-ui.list-panel{margin-bottom:1.5rem;flex:1}

                                .pinc-oauth-ui.list-columns{flex:1;display:flex;min-width:280px;box-shadow: rgba(67, 90, 111, 0.3) 0px 0px 1px, rgba(67, 90, 111, 0.47) 0px 2px 4px -2px;border-radius:.5rem;overflow:hidden}
                                .pinc-oauth-ui.list-columns .p-name-group{flex-direction:column;height:100%;justify-content:space-between;}
                                .pinc-oauth-ui.list-columns .p-name-group-text{justify-content:space-between;display:flex;flex-direction:column}
                                .pinc-oauth-ui.list-columns .c-item-label{flex-direction:column;height:100%}
                                .pinc-oauth-ui.list-columns .c-item-label .btn-connect{margin-left:0px !important;margin-top: 1rem !important}
                                .pinc-oauth-ui.list-columns .c-item-text {margin-top: 1rem !important}
                                .pinc-oauth-ui.list-columns .tool-revoke{margin-left:auto}

                               
                                .pinc-oauth-ui.list-panel .c-item
                                {border-radius: .25rem!important;}

                                .pinc-oauth-ui.list .c-item
                                {border-bottom:1px solid var(--pinc-oauth-ui-panel-border-color);}
                                .pinc-oauth-ui .provider-description{min-width:150px;}

                                .pinc-oauth-ui .multipanel-on
                                {border-color: #eaeaea !important;border-radius: .25rem!important;border:1px solid;margin-bottom:.5rem;overflow:hidden}


                                .pinc-oauth-ui .btn-connect[data-oauth-command^="google"]{
    	                            border-color: #4285F4;
                                    position:relative;
                                    padding-left:38px;
                                }
                                .pinc-oauth-ui .btn-connect[data-oauth-command^="google"]:before{
                                    content:'';
                                    position:absolute;
                                    left:0px;
                                    top:0px;
                                    width:30px;
                                    height:100%;
                                    border-radius:.2rem;
                                    background:#fff url('${$pinc.environment.imageHost}i/googleidentity-icon.png') no-repeat center;
                                    background-size:18px 18px;
                                }

                                .pinc-oauth-ui .btn-connect{
	                                color: {{color}};
    	                            border-color: {{color}};
                                    font-weight:500;
                                    cursor:pointer;
                                }

                                .pinc-oauth-ui .btn-connect:hover{
                                    color: #fff;
                                    background-color: {{color}};
                                    border-color: {{color}};
                                }

                                .pinc-oauth-ui .btn-connect:focus,
                                .pinc-oauth-ui .btn-connect:active
                                {
                                    box-shadow: 0 0 0 0.2rem rgba({{color_rgb}},.5);
                                }
                            </style>`,s=t.filter(n=>n.authorized==!0&&n.name.indexOf("identity")<0),h=t.filter(n=>n.authorized!=!0&&n.name.indexOf("identity")<0),r;s.forEach(n=>{u(n)});h.forEach(n=>{u(n)});i.append($pinc.dataReplace(o,n))}function w(n,t,i){function h(t){var o=f[t.name]!=null,i,r;f[t.name]=f[t.name]||{config:t,authorizations:[]};o||s.push(f[t.name]);t.authorized&&(i=Object.assign({},t),r=u.filter(n=>n.map_id==t.user_id&&n.provider==t.provider)[0],r!=null?(i.clientId=n.clientId,i.userId=t.user_id,i.connectionName=r.name,f[t.name].authorizations.push($pinc.dataReplace(l,i))):e({provider:t.provider,oauthUserId:t.user_id,clientId:n.clientId},!1))}var c=`<div class="d-flex flex-column rounded mb-4 c-item mx-1 mt-1 cursor-pointer" data-primary-user-id="${n.userId}" style="background-color:var(--pinc-oauth-ui-panel-bg-color);box-shadow:0 1px 1px 0 rgb(0 0 0 / 10%), 0 1px 3px 0 rgb(0 0 0 / 10%), 0 0 1px 0 rgb(0 0 0 / 10%);">
                                            <div class="p-4 flex-grow-1 " data-toggle="collapse" data-custom-target=".{{id}}-child" >
                                                <div class="d-flex">
                                                    <div class="mr-3 my-1">
                                                        <i class="icon-{{iconSize}} p-1 rounded bg-white c-item-icon" style="background-image:url('${$pinc.environment.imageHost}i/{{name}}-icon.png')"></i>
                                                    </div>
                                                    <div class="">
                                                        <div class="font-weight-md">{{label}}
                                                            <span class="badge badge-success {{activeDisplay}}">
                                                                {{activeCount}}
                                                            </span>
                                                        </div>
                                                        <div class="py-1">{{description}}</div>
                                                    </div>
                                                    <div class="ml-auto d-flex flex-column ">
                                                        <div class="text-right">
                                                            <button class="btn btn-outline-primary btn-sm py-0" data-oauth-command="{{name}}.call" data-client-id="{{oauthClientId}}" data-oauth-user-id="$pinc.oauth.client.getDynamicUserId('{{oauthUserId}}')">Add Connection</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="collapse {{id}}-child">
                                            <div class="mx-4 pb-4" style="display:grid;grid-gap:1rem 1rem;grid-template-columns: repeat(auto-fill, minmax(250px,1fr));">
                                                #authorization#
                                            </div>
                                            </div>
                                        </div>`,l=`<div class="d-flex flex-column  border rounded p-3 " 
                                        data-client-id="{{clientId}}" 
                                        data-oauth-user-id="{{userId}}"
                                        data-provider="{{name}}"
                                        style="max-width:400px;min-width:250px;background-color:var(--pinc-oauth-ui-panel-l2-bg-color);cursor:default">
                                        <div class="mb-3 connection-display">
                                            <div class="connection-name border-0 px-0" style="background:transparent">
                                                <i class="fal fa-pencil mr-2 hover-opacity"></i><span class="name font-weight-md">{{connectionName}}</span>
                                            </div>
                                            <form class="d-none connection-input">
                                                <div class="input-group input-group-sm">
                                                    <input class="form-control" maxlength="40" placeholder="Name this connection" required/>
                                                    <div class="input-group-append">
                                                        <button class="btn btn-primary">Save</button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <div class="text-success text-sm">                                            
                                                <i class="fas fa-check-circle pr-1  " ></i>
                                                Connected
                                            </div>
                                            <div class="ml-3 d-flex cursor-pointer align-items-center text-sm tool-revoke" style="color:var(--pinc-oauth-ui-panel-text-color)">
                                                <i class="fas fa-minus-circle pr-1 text-muted " title="Disconnect" ></i>
                                                <div>Disconnect</div>
                                            </div>
                                        </div>
                                    </div>`,f={},s=[],a=t.filter(n=>u.filter(t=>t.provider==n.provider).length>0),v=t.filter(n=>u.filter(t=>t.provider==n.provider).length==0),r,o;a.forEach(n=>{h(n)});v.forEach(n=>{h(n)});r="";s.sort(n=>n.authorizations.length>0?-1:1);s.forEach(t=>{var u,i,f;t.authorizations.length>0!=o&&(u=o==null?"mt-0":"mt-5",o=t.authorizations.length>0,r+=o?`<div class="${u} px-2 mb-4  text-muted pinc-oauth-ui connection-group-header">Connected Apps</div>`:`<div class="${u} px-2 mb-4 text-muted pinc-oauth-ui connection-group-header">Apps available for Integration</div>`);i=t.config;i.id=`od-${$pinc.getGuid()}`;i.iconSize=n.iconSize;i.oauthUserId=n.userId;i.oauthClientId=n.clientId;i.activeCount=t.authorizations.length;i.activeCount==0&&(i.activeDisplay="d-none");f=$pinc.dataReplace(c,i);r+=t.authorizations.length>0?f.replace("#authorization#",t.authorizations.join("")):f.replace("#authorization#",`<div class="d-flex justify-content-center text-sm text-muted my-3" style="grid-column:span 6/6"><i>No connections added</i></div>`)});i.html(`<div class="pinc-oauth-ui">${r}</div>`);i.append(`<style>
                                :root{
                                    --pinc-oauth-ui-panel-bg-color:#fff;
                                    --pinc-oauth-ui-panel-text-color:#000;
                                    --pinc-oauth-ui-panel-light-text-color:#6c757d;
                                    --pinc-oauth-ui-panel-l2-bg-color:#F8F9FA;
                                    --pinc-oauth-ui-panel-hover-bg-color:#f8f9fa;
                                }

                                .pinc-oauth-ui i.fas,.pinc-oauth-ui i.fad,.pinc-oauth-ui i.fal,.pinc-oauth-ui i.fa{
                                    font-style:normal
                                }
                                .pinc-oauth-ui.connection-group-header{
                                    font-size:1.2em;
                                }

                            </style>`)}function e(n,t){$pinc.oauth.revoke(n.provider,n.oauthUserId,n.clientId,t);$pincj.post(`${$pinc.environment.azHost}usermap/delete`,JSON.stringify({client_id:n.clientId,tenant_id:"B835E350-8C22-4F30-9E68-C59108B58160",map_id:n.oauthUserId,provider:n.provider}))}function c(){var n=$pincj(i.container);n.find(".tool-revoke").unbind();n.find(".tool-revoke").on("click",n=>{n.stopPropagation();n.preventDefault();var i=$pincj(n.target).closest(".tool-revoke"),t=$pincj(n.target).closest("[data-provider]"),r=t.data();i.addClass("d-none");t.css({"pointer-events":"none"});$pinc.elMessage({selector:t,additionalStyle:";left:0px;position:absolute",allowHide:!1,autoHide:!1,message:`<div class="text-sm text-white bg-dark p-2 rounded">Disconnecting...</div>`});e(r)});n.find(".tool-check").unbind();n.find(".tool-check").on("click",n=>{n.stopPropagation(),n.preventDefault(),$pincj(n.target).toggleClass("fa-square fa-check-square"),$pinc.events.fire("$pinc.oauth.client","change")});n.find(".connection-name").unbind();n.find(".connection-name").on("click",n=>{var t=$pincj(n.target).closest(".connection-display"),u=t.find(".connection-name"),i=t.find(".connection-input"),r=i.find("input");r.val(t.find(".name").text());i.removeClass("d-none");u.addClass("d-none");setTimeout(()=>{r[0].focus()},100)});n.find(".connection-input").unbind();n.find(".connection-input").on("submit",n=>{var t=$pincj(n.target).closest(".connection-display"),e=t.find(".connection-name"),r=t.find(".connection-input"),u=r.find("input"),i,f;return t.find(".connection-name").removeClass("d-none"),t.find(".name").text(u.val()),r.addClass("d-none"),e.removeClass("d-none"),i=t.closest("[data-client-id]").data(),f=t.closest("[data-primary-user-id]").data().primaryUserId,o(i.clientId,i.oauthUserId,f,i.provider,u.val()),!1});n.find("[data-custom-target]").on("click",t=>{var i=$pincj(t.target).closest("[data-custom-target]").data().customTarget,r=n.find(i);r.toggleClass("show")})}var l=this,i,u;this.refresh=function(n,t){a(n,t);i.refresh=!0;i.switches.multi&&t==!0?$pinc.modals.prompt({header:`Name Your Connection <i class="icon-md rounded bg-white mr-2" style="background-image:url('${$pinc.environment.imageHost}i/${n.provider}-icon.png')"></i>`,inputType:"sm",message:`<div class="d-flex justify-content-between align-items-center mb-3">
                                    <span>Enter a name for the connection</span>
                                    <span class="text-danger text-sm">required</span>
                                </div>`,callback:t=>{n.name=t,$pinc.events.fire("$pinc.oauth","consented",n),o(i.clientId,n.userId,i.userId,n.provider,t,()=>{f()})},allowHide:!0}):(t==!0&&$pinc.events.fire("$pinc.oauth","consented",n),f())};i={};n!=null&&(v(),f());u=[]};e(n)};$pinc.oauth.client.getDynamicUserId=function(n){return n+"."+$pinc.getGuid()};$pinc.oauth.mcon=new function(){function n(){}var t=this;$pinc.events.on("$pinc.oauth","consented",n);$pinc.events.on("$pinc.oauth","revoked",n);$pinc.uiLibrary()};typeof $pinc=="undefined"&&($pinc={});$pinc.attach=new function(){var n=this;this.bootStrap_tooltips=function(){$pinc.onNodesAdded(function(){$pincj("[title]").tooltip()});$pincj("[title]").tooltip()};$pincj(document.body).on("click",n=>{var f=$pincj(n.target).closest(".copy-button"),r,t,u,i;f.length!=0&&(n.preventDefault(),n.stopPropagation(),r=f.find(".copy-button-text"),t=$pincj(n.target).closest("[data-copy]"),r.text(""),u=t.text(),t.data().copyTarget!=null&&(i=$pincj(t.data().copyTarget),u=i.hasClass("form-control")?i.val():i.text()),$pinc.copy(u,()=>{r.text("Copy");var n=t.data().copyMessage||"Copied";$pinc.elMessage({dock:"bottomIn",classes:"text-sm rounded bg-dark text-white p-3 m-2",styles:"max-width:300px",message:n})}))})};$pinc.eh_track=new function(){function r(i){if(t!=!0){t=!0;var r=$pincj(i.target),u={className:i.target.className,id:r.attr("id"),text:r.text().substr(0,20)};n.socket.send(JSON.stringify(u));setTimeout(function(){t=!1},2e3)}}var n=this,i,t;this.socket;const u={click:"CLICK",error:"ERROR"};if(i=new URL(window.location.href),!(i.pathname.indexOf("eh.html")>=0)){t=!1;$pincj.fn.monitor=function(){var t=this,i=$pincj(t).attr("data-eh-track");if(i!=null){i=i.toUpperCase();$pincj(t).attr("data-eh-track",null);$pincj(t).on("click",function(){n.postToHub({event_type:u.click})})}};$pinc.onNodesAdded(function(){$pincj("[data-eh-track]").monitor()});$pincj("[data-eh-track]").monitor()}};$pinc._copy=function(n){var r=$pincj,t=$pincj(n.target).closest("[data-copy]"),i;$pinc.isNullOrEmpty(t.attr(`[data-copy-attached]`))&&(t.attr("data-copy-attached","true"),t.css("position","relative"),i=`<div  class=" animated text-right d-flex justify-content-end align-items-center" style="position:sticky;bottom:0px;width:100%;font-size:.8rem !important;font-weight:300;cursor:pointer;color:#8CB6C1 !important" >
                <button class="copy-button btn btn-secondary m-2 btn-sm ">
                    <i class="fal fa-copy text-sm" ></i> 
                    <span class="copy-button-text text-sm">Copy</span>
                </button>
            </div>`,t.append(i))};$pinc.attachCopy=()=>{$pincj("[data-copy]:not([data-copy-attached])").each(function(n,t){var i=$pincj(t),r;i.attr("data-copy-attached","true");i.css("position","relative");r=`<div  class=" animated text-right d-flex justify-content-end align-items-center" style="position:sticky;bottom:0px;width:100%;" >
                <button class="copy-button btn btn-outline-secondary m-2 btn-xs ">
                    <i class="fal fa-copy " ></i> 
                    <span class="copy-button-text">Copy</span>
                </button>
            </div>`;i.append(r)})};$pinc.copy=function(n,t){function f(i){i.clipboardData.setData("text/plain",n);i.preventDefault();document.removeEventListener("copy",f,!0);t!=null&&t()}var i,r,u;if(navigator.clipboard)document.addEventListener("copy",f,!0),document.execCommand("copy");else{i=document.createElement("textarea");i.value=n;document.body.appendChild(i);i.focus();i.select();try{r=document.execCommand("copy");u=r?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+u)}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(i);t!=null&&t()}};typeof $pinc=="undefined"&&($pinc={});$pinc.auth=new function(){function c(){var i=t(),n=new Date;return n.addMinutes(i.sessionDurationMinutes),n.valueOf()}function p(){var t=$pinc.data,n=window._pinc_auth_clientId||t.authClientId||$pinc.clientId;if(!$pinc.isNullOrEmpty(n))try{return eval(n)}catch(i){return n}return n}var f=this,l=!1,o=3,n={},a={fbidentity:{authName:"fbIdentity",map:{name:"{{first_name}} {{last_name}}",firstName:"{{first_name}}",lastName:"{{last_name}}",email:"{{email}}",id:"{{id}}",pic:"{{picture.data.url}}"}},googleidentity:{authName:"googleIdentity",map:{name:"{{name}}",firstName:"{{given_name}}",lastName:"{{family_name}}",email:"{{email}}",id:"{{id}}",pic:"{{picture}}"},picture:"{{picture}}"},amazonidentity:{authName:"githubidentity",map:{id:"{{user_id}}",name:"{{name}}",firstName:"{{name}}",lastName:"",email:"{{email}}"},picture:"none"},githubidentity:{authName:"githubidentity",map:{name:"{{name}}",firstName:"{{name}}",lastName:"",email:"{{email}}"},picture:"{{avatar_url}}"},msazureadidentity:{authName:"msazureadIdentity",map:{name:"{{displayName}}",firstName:"{{givenName}}",lastName:"{{surname}}",email:"{{userPrincipalName}}"},picture:"{{picture}}"},msidentity:{authName:"msIdentity",map:{name:"{{displayName}}",firstName:"{{givenName}}",lastName:"{{surname}}",email:"{{userPrincipalName}}"},picture:"{{picture}}"},kakaoidentity:{authName:"kakaoIdentity",map:{name:"{{kakao_account.profile.nickname}}",firstName:"{{kakao_account.name}}",lastName:"{{surname}}",email:"{{kakao_account.email}}",phone:"{{kakao_account.phone_number}}",pic:"{{kakao_account.profile.thumbnail_image_url}}"},picture:"{{kakao_account.profile.thumbnail_image_url}}"},naveridentity:{authName:"naverIdentity",map:{name:"{{response.nickname}}",firstName:"{{response.name}}",lastName:"{{response.name}}",email:"{{response.email}}",pic:"{{response.profile_image}}"},picture:"{{response.profile_image}}"},pincidentity:{authName:"pincIdentity",map:{name:"{{first_name}} {{last_name}}",firstName:"{{first_name}}",lastName:"{{last_name}}",email:"{{login_id}}",verified:"{{verified}}",vCode:"{{v_code}}"},picture:"{{picture}}"},linkedinidentity:{authName:"linkedinIdentity",map:{name:"{{firstName.localized.en_US}} {{lastName.localized.en_US}}",firstName:"{{firstName.localized.en_US}}",lastName:"{{lastName.localized.en_US}}",email:"{{email}}",id:"{{id}}",verified:"{{verified}}",pic:`{{profilePicture['displayImage~'].elements[0].identifiers[0].identifier}}`}},linkedinv2identity:{authName:"linkedinv2Identity",map:{name:"{{name}}",firstName:"{{given_name}}",lastName:"{{family_name}}",email:"{{email}}",id:"{{sub}}",verified:"{{email_verified}}",pic:`{{picture}}`}},twitteridentity:{authName:"twitterIdentity",map:{name:"{{name}}",firstName:"{{name}}",lastName:"{{screen_name}}",email:"{{email}}",pic:"{{profile_image_url_https}}",handle:"{{screen_name}}",id:"{{id}}",verified:"{{verified}}"},picture:"{{profile_image_url}}"},spotifyidentity:{authName:"spotifyIdentity",map:{name:"{{display_name}}",firstName:"{{display_name}}",lastName:"",email:"{{email}}",id:"{{id}}",verified:"{{verified}}",pic:"{{images[0].url}}"},picture:"{{profile_image_url}}"},discordidentity:{authName:"spotifyIdentity",map:{name:"{{username}}",firstName:"{{username}}",lastName:"",email:"{{email}}",id:"{{id}}",verified:"{{verified}}",pic:"{{avatar}}"},picture:"{{avatar}}"},twitchidentity:{authName:"twitchIdentity",map:{name:"{{data[0].display_name}}",firstName:"{{data[0].display_name}}",lastName:"",email:"{{data[0].email}}",id:"{{data[0].id}}",pic:"{{data[0].profile_image_url}}"}},appleidentity:{authName:"appleIdentity",map:{name:"{{user.name.firstName}} {{user.name.lastName}}",firstName:"{{user.name.firstName}}",lastName:"{{user.name.lastName}}",email:"{{email}}",verified:"{{verified}}",pic:""}}},i=function(n){var r=this,i=n;return i.userId="identity_user",this.autoLogin=function(){var f=t(),r=0,e={data:{}};$pinc.events.on("$pinc.oauth","ready",()=>{function t(n){function c(n){var t,f;if(r--,!(r<0)){if(n.rows!=null&&n.rows[0].pincStatus!="error"){t=n.rows[0];t.contentType=="text/javascript"&&(t.data=JSON.parse(t.data));Object.assign(e.data,t.data);for(f in n.rows[0])f!="data"&&(e[f]=n.rows[0][f])}else r=-1,u(i.provider);r==0&&o(e)}}var l=n.type||"oauth",s,t,h;switch(l.toLowerCase()){case"oauth":s=$pinc.getPathfixUrl(i.provider,f.clientId,null);s.searchParams.set("oauthId",$pinc.oauth.getOauthId(i.provider).id);n.method=n.method||"GET";n.payload=n.payload||{};$pincj.post(s,JSON.stringify(n)).always(c);break;case"get":t=n.url;h={oauthId:$pinc.oauth.getOauthId(i.provider).id,publicKey:f.clientId};t=$pinc.dataReplace(t,h);$pincj.get(t).always(c)}}function o(t){try{var r=eval(`arguments[0].data.${i.email}`)||t.data.email,e=eval(`arguments[0].data.${i.id}`)||t.data.id;r!=null||e!=null?(t.data.email=r,t.data.id=e,t.data.provider=i.provider,h(t.data)):($pinc.modals.error({message:`The authorization with ${n.provider} was successful, but the <b>Email Id</b> is missing from your public profile on GitHub. Please complete it to continue using ${n.provider} to login.`,header:"Insufficient Profile Information"}),$pinc.oauth.revoke(i.provider,"identity_user",f.clientId),u(i.provider))}catch(o){u(i.provider)}}$pinc.oauth.authorized(i.provider,i.userId,n=>{n?(r=i.request.length,i.request.forEach(function(n){t(n)})):u(i.provider)})},!0)},this.signOut=function(n){var u=t(),r=$pinc.getPathfixRevokeUrl(i.provider,u.clientId,null);r.searchParams.set("oauthId",$pinc.oauth.getOauthId(i.provider).id);$pincj.post(r,null).always(n)},r},t;Object.defineProperty(f,"settings",{get:function(){return t()}});Object.defineProperty(f,"profile",{get:()=>n,set:t=>{try{Object.assign(n,t);s.extend(!0)}catch(i){$pinc.trace("ERROR:"+i.message)}}});this.signOut=function(t){function i(n){n==null&&(n={loginStatus:"signed_out"});t!=null&&t(n)}if(n.provider==null)return i({loginStatus:"expired"});var u=(a[n.provider]||{}).authName;try{v[u.replace("Identity","")].signOut(i)}catch(f){i()}r("active_profile",null);$pinc.oauth.setOauthId(n.provider,null,null);$pinc.events.fire("$pinc.auth","signout");n={}};var vt=new function(){this.reset=function(n){var r=n.success||function(){},u=n.fail||function(){},i=$pinc.getGuid(),t={};t.p_login=n.login;t.p_guid=i;$pincj.post($pinc.environment.authHost+"resetPassword",JSON.stringify(t)).always(function(t){var e=t.status,f;e.toUpperCase()==="SUCCESS"?(f={id:i,login:n.login},r(f)):u(f)},"json")};this.validate=function(n){var i=n.success||function(){},r=n.fail||function(){},t={};t.p_login=n.login;t.p_guid=n.gid;t.p_pwd=n.pwd;$pincj.post($pinc.environment.authHost+"validateReset",JSON.stringify(t)).always(function(t){var f=t.status[0].status,u;f==="SUCCESS"?(u={id:n.gid,login:n.login},i(u)):r()},"json")}},w=new function(){function n(n,i,u){var f=t();n.provider="pincidentity";r(f.sessionId,JSON.stringify(n));h(n,i,u)}f.pincIdentity=this;this.autoLogin=function(){var f={},o=t(),s,i,e;try{f=JSON.parse(r(o.sessionId));s=c();i=new URL($pinc.environment.authAzHost+"getloginstatus");i.searchParams.set("p_login",f.login_id);i.searchParams.set("p_sid",o.sessionId);i.searchParams.set("p_sexp",s);i.searchParams.set("p_clientTime",(new Date).valueOf());$pincj.getJSON(i,function(t){var i=(t.status||[])[0],o=i.status,h=i.acDate,s;f.verified=i.verified;f.v_code=i.v_code;s=i.domainKey;e=t;e.status=o;o=="CONNECTED"?n(f):(r("pincidentity.session",null),u("pincidentity"));$pinc.events.fire("$pinc.auth","profileconfirmed")})}catch(h){u("pincidentity")}e={}};this.createAccount=function(t){var i=y(t);i.p_sid=$pinc.newSession();i.p_verification=$pinc.getGuid().substr(0,6);i.p_sexp=c();$pincj.post($pinc.environment.authHost+"createAccount",JSON.stringify(i)).always(function(u){var f=u.rows[0].status;f=="USER-CREATED"?(t.id=i.p_sid,n(u.profile[0],!0,i.p_verification),t.callback!=null&&t.callback(!0)):(t.callback!=null&&t.callback(!1),r("pincidentity.session",null))},"json")};this.authenticate=function(t){var u=$pinc.newSession(),f=c(),i=y(t);i.p_sid=u;i.p_sexp=f;$pincj.post($pinc.environment.authHost+"authenticate",JSON.stringify(i)).always(function(i){if(i.rows[0].status=="AUTHENTICATED"){t.id=u;t.userId=i.userId;n(i.profile[0],!0);try{t.callback(!0)}catch(f){}}else{try{t.callback(!1)}catch(f){}r("pincidentity.session",null)}},"json")};this.verify=function(n){var i=t(),r={code:n.code,tenantId:i.clientId};n.callback=n.callback||function(){};$pincj.get($pinc.environment.authAzHost+"verify",r,t=>{var i=t.rows||[];n.callback(i[0])})};this.password={reset:function(n){var t={};t.p_login=n.login;t.p_guid=$pinc.getGuid();$pincj.post($pinc.environment.authAzHost+"resetpassword",JSON.stringify(t)).always(function(){var i={id:t.p_guid,login:n.login};n.callback!=null&&n.callback(i)},"json")},checkResetId:function(n){var t={p_login:n.login,p_guid:n.resetId};$pincj.get($pinc.environment.authAzHost+"checkResetId",t,function(t){n.callback!=null&&(t.rows==null?n.callback(!1):n.callback(!0))},"json")},validate:function(n){var t={};t.p_guid=n.id;t.p_pwd=n.password;t.p_login=n.login;$pincj.post($pinc.environment.authHost+"validatereset",JSON.stringify(t)).always(function(t){n.callback!=null&&n.callback(t.rows[0].status=="SUCCESS")})}};this.signOut=function(n){options=t();r(options.sessionId,null);r("_session-id",null);n()}},b=new function(){var n="githubidentity";this.autoLogin=function(){function r(t){var r=(t.rows||[])[0];try{if(r.pincStatus!="error"){if($pinc.isNullOrEmpty(r.data.email)){$pinc.modals.error({message:"The authorization with GitHub was successful, but the <b>Email Id<\/b> is missing from your public profile on GitHub. Please complete it to continue using GitHub to login.",header:"Insufficient Profile Information"});u(n);$pinc.oauth.revoke(n,"identity_user",i.clientId);return}r.data.provider=n;h(r.data)}else u(n)}catch(f){u(n)}}var i=t();$pinc.events.on("$pinc.oauth","ready",()=>{$pinc.oauth.authorized(n,"identity_user",function(t){var f,e;t?(f=$pinc.getPathfixUrl(n,i.clientId,null),f.searchParams.set("oauthId",$pinc.oauth.getOauthId(n).id),e={url:"https://api.github.com/user",method:"GET",payload:{}},$pincj.post(f,JSON.stringify(e)).always(r)):u(n)})},!0)}},k=new function(){return new i({provider:"googleidentity",request:[{url:"https://www.googleapis.com/oauth2/v1/userinfo?alt=json"}],email:"email",id:"id"})},d=new function(){var n={provider:"linkedinidentity",request:[{url:"https://api.linkedin.com/v2/me?projection=(id,firstName,lastName,profilePicture(displayImage~digitalmediaAsset:playableStreams))"},{url:"https://api.linkedin.com/v2/emailAddress?q=members&projection=(elements*(handle~))"}],email:`elements[0]["handle~"].emailAddress`};return new i(n)},g=new function(){var n={provider:"linkedinv2identity",request:[{url:"https://api.linkedin.com/v2/userinfo"},],email:`email`};return new i(n)},nt=new function(){return new i({provider:"msazureadidentity",request:[{url:"https://graph.microsoft.com/v1.0/me"}],email:"userPrincipalName"})},tt=new function(){return new i({provider:"msidentity",request:[{url:"https://graph.microsoft.com/v1.0/me"}],email:"userPrincipalName"})},it=new function(){return new i({provider:"naveridentity",request:[{url:"https://openapi.naver.com/v1/nid/me"}],email:"response.email"})},rt=new function(){return new i({provider:"kakaoidentity",request:[{url:"https://kapi.kakao.com/v2/user/me"}],email:"kakao_account.email"})},ut=new function(){return new i({provider:"fbidentity",request:[{url:"https://graph.facebook.com/me?fields=id,first_name,last_name,email,picture.type(large)"}],email:"email",id:"id"})},ft=new function(){return new i({provider:"discordidentity",request:[{url:"https://discord.com/api/users/@me"}],email:"email",id:"id"})},et=new function(){var n={provider:"appleidentity",request:[{url:`${$pinc.environment.labsHost}oauth/userdata/appleidentity?public_key={{publicKey}}&oauthId={{oauthId}}`,type:"GET"},{url:`${$pinc.environment.labsHost}oauth/idtoken/appleidentity?public_key={{publicKey}}&oauthId={{oauthId}}`,type:"GET"}],email:"email"};return new i(n)},ot=new function(){return new i({provider:"spotifyidentity",request:[{url:"https://api.spotify.com/v1/me"}],email:"email",id:"id"})},st=new function(){return new i({provider:"twitchidentity",request:[{url:"https://api.twitch.tv/helix/users"}],email:"data[0].email",id:"data[0].id"})},ht=new function(){return new i({provider:"twitteridentity",request:[{url:"https://api.twitter.com/1.1/account/verify_credentials.json?include_email=true"}],email:"email",id:"id"})},ct=new function(){return new i({provider:"amazonidentity",request:[{url:"https://api.amazon.com/user/profile"}],email:"email",id:"user_id"})},v={naver:it,kakao:rt,ms:tt,fb:ut,linkedin:d,linkedinv2:g,msazuread:nt,google:k,pinc:w,github:b,twitter:ht,spotify:ot,apple:et,discord:ft,twitch:st,amazon:ct},y=function(n){var r=t(),i=JSON.parse(JSON.stringify(n));return i.client_id=r.clientId,i},e=[];Object.defineProperty(f,"providers",{get:function(){return t().providers}});Object.defineProperty(f,"clientId",{get:function(){return p()}});t=function(){var n={},t=$pinc.data,i,r;return n.clientId=p(),n.sessionMustRevalidate=parseInt(t.authSessionMustValidate||"10080"),n.sessionDurationMinutes=parseInt(window._pinc_session_duration||t.authSessionDuration||"2880"),n.providers=e,i=t.authProviders||t.uiAuthProviders||t.uiProviders,e.length>0&!$pinc.isNullOrEmpty(i)&&(r=i.split(","),n.providers=e.filter(n=>r.some(t=>t==n))),n.sessionDurationMs=n.sessionDurationMinutes*6e4,n.sessionId=$pinc.getSessionId(null,n.clientId),n.nowMs=(new Date).valueOf(),n};this.init=function(){f.autoInit(!0)};this.autoInit=function(i){if(i=i||!1,$pinc.trace("attempting auto initialize"),($pinc.data.authAutoInit==!1||$pinc.data.authAutoInit=="false")&&!i)return $pinc.trace("fired auth ready from authAutoInit"),$pinc.events.fire("$pinc.auth","ready");$pinc.events.on("$pinc.oauth","consentRedirect",n=>{n.provider==null&&at()},!0,!0);$pinc.events.on("$pinc.oauth","ready",()=>{var r=t();$pinc.trace("pinc.auth:","OAuth ready");$pinc.oauth.client.connections({clientId:r.clientId,userId:"empty",filterByProviderTypes:"identity",callback:t=>{if($pinc.trace("pinc.auth:","identity connections available:"+t.length),t.length==0){$pinc.events.fire("$pinc.auth","profileinvalid");i||$pinc.events.fire("$pinc.auth","ready");return}if(t.forEach(n=>{var t=n.name.replace("identity","");e.indexOf(t)<0&&e.push(t)}),s.reValidate(n)){o=r.providers.length;r.providers.forEach(function(n){try{$pinc.trace(`${n}.autoLogin()`);v[n].autoLogin()}catch(t){$pinc.trace(t.message)}});$pinc.events.on("$pinc.oauth","autologin",h,!0);$pinc.events.on("$pinc.oauth","autologinfail",u)}else $pinc.events.fire("$pinc.auth","profileset"),$pinc.events.fire("$pinc.auth","sessionschecked");i||($pinc.trace("auth ready fired from autoInit"),$pinc.events.fire("$pinc.auth","ready"))}})},!0,!0)};var lt=function(t){if(n!=null)for(var i in t)if(n[i]!=t[i]){changed=!0;break}if(Object.assign(n,t),n.oauthId=$pinc.oauth.getOauthId(n.provider).id,s.extend(!0),$pinc.events.fire("$pinc.auth","profileset"),$pinc.data.onLoggedIn!=null)try{eval($pinc.data.onLoggedIn)}catch(u){console.log(`${$pinc.data.onLoggedIn} Callback returned an error!`)}changed&&$pinc.events.fire("$pinc.auth","profilechange");r("active_profile",JSON.stringify(n))},s=new function(){this.extend=function(i){var u=t();(n._sessionExpiry!=null&&n._sessionExpiry-u.nowMs>0||i)&&(n._sessionExpiry=(new Date).addMinutes(u.sessionDurationMinutes).valueOf(),r("active_profile",JSON.stringify(n)))};this.reValidate=function(n){var i=t();return n._sessionExpiry!=null&&i.nowMs-n._sessionExpiry<0?!1:(n._sessionExpiry==null,!0)}},r=function(n,i){var r=t();return i===undefined?$pinc.getCookie(n,r.clientId):$pinc.setCookie(n,i,r.clientId)},at=function(){if(n=JSON.parse(r("active_profile")||"{}"),$pinc.isNullOrEmpty(n.email)&&$pinc.isNullOrEmpty(n.id))$pinc.events.fire("$pinc.auth","noprofile");else{var t=$pinc.data;delete n.newAccount;l=!0;s.extend();$pinc.events.fire("$pinc.auth","profileready",n)}},u=function(t){if((o--,$pinc.trace(t+" "+o),!(o>0))&&(r("active_profile",null),n={},$pinc.trace("$pinc.auth.profileinvalid"),$pinc.events.fire("$pinc.auth","profileinvalid"),$pinc.events.fire("$pinc.auth","sessionschecked"),$pinc.data.onLoggedOut!=null))try{eval($pinc.data.onLoggedOut)}catch(i){console.log(`${$pinc.data.onLoggedOut} Callback returned an error!`)}},h=function(n,t,i){var e=JSON.stringify(a[n.provider].map),r=JSON.parse($pinc.dataReplace(e,n,!1)),f,u;if(n.provider=="linkedinidentity")try{f=`${n.firstName.preferredLocale.language}_${n.firstName.preferredLocale.country}`;r.firstName=n.firstName.localized[f];r.lastName=n.lastName.localized[f];r.name=`${r.firstName} ${r.lastName}`}catch(o){}for(u in n)r[u]!=null?r[`${n.provider}_${u}`]=n[u]:r[u]=n[u];r.newAccount=i;r.provider=n.provider;lt(r);l||($pinc.trace("$pinc.auth.profileready"),$pinc.events.fire("$pinc.auth","profileready",r));$pinc.trace("$pinc.auth.sessionactive");$pinc.events.fire("$pinc.auth","sessionschecked");$pinc.events.fire("$pinc.auth","sessionactive",r)}};$pinc.environment.authHost=`${$pinc.environment.labsHost}auth/`;$pinc.environment.authAzHost=`${$pinc.environment.labsHost}adb/q/login/`;$pinc.events.fire("$pinc.auth","load");$pinc.auth.autoInit();$pinc.ui.auth=new function(){function r(){try{var r=$pinc.data.uiButtonPrefix||"";$pinc.auth.providers.forEach(function(n){if(!$pinc.isNullOrEmpty(n))try{var f=$pinc.oauth.providers.configuration(n+"identity");f.icon=$pinc.dataReplace(t.icon,f,!1);f.buttonLabel=(r?r+" ":"")+u[n];f.clientId=$pinc.auth.clientId;i.root.append($pinc.dataReplace(t.button,f,!1))}catch(e){console.log(e.message)}});n._rendered=!0}catch(f){console.error("Pathfix-Configuration Error in data-ui-providers")}}var n=this,t={root:`<style>
                    .pinc-ui .pinc-auth-button
                    {
                        border-color:#ddd;
                        font-size:14px;
                        border-color:#ddd;
                        filter:brightness(.92);
                        transition:all .25s linear;
                    }
                    .pinc-ui .pinc-auth-button:hover{
                        filter:brightness(1);

                    }
                    .pinc-ui .pinc-auth-text{
                        font-weight:bold;
                    }
                </style><div class='animated fadeInDown pinc-ui' ><div class="d-flex pua-root flex-column" ></div></div>`,icon:`<i style="width: 1em;height: 1em;background:#fff url('${$pinc.environment.imageHost}i/{{name}}-icon.png') no-repeat center center ;background-size: .9em .9em;"></i>`,button:`<div class="btn d-flex align-items-center my-2 pinc-auth-button" data-oauth-command="{{name}}.call" data-client-id={{clientId}} style="cursor:pointer;">
                        <span class="bg-white d-flex align-items-middle border p-1 rounded" >
                            {{icon}}
                        </span>
                        <span class="flex-grow-1 pinc-auth-text" style="padding-right:1em;">{{buttonLabel}}</span>
                    </div>`,hello:`Hello {{name}}`},u={google:"Google",linkedin:"LinkedIn",linkedinv2:"LinkedIn v2",fb:"Facebook",github:"GitHub",ms:"Microsoft",msazuread:"Azure AD",discord:"Discord",twitter:"Twitter",spotify:"Spotify",apple:"Apple",twitch:"Twitch",amazon:"Amazon",kakao:"Kakao",naver:"Naver"},i={};$pinc.uiLibrary();this.init=function(){$pinc.events.on("$pinc.auth","profileset",n.auth.knownUser,!0);$pinc.events.on("$pinc.auth","profileinvalid",n.auth.unKnownUser,!0);$pinc.events.on("$pinc.auth","signout",()=>{n._rendered=!1,r(),n.displayLoginState()});n.render($pincj(document.getElementById("pinc.helper").parentNode));$pinc.events.fire("$pinc.ui.auth","ready")};this.auth={knownUser:function(){$pinc.events.fire("$pinc.ui.auth","loggedin",JSON.parse(JSON.stringify($pinc.auth.profile)));n.displayLoginState()},unKnownUser:function(){$pinc.events.fire("$pinc.ui.auth","loggedout",{})}};this.render=function(u){function f(){var f=$pincj(u);f.append(t.root);i.root=f.find(".pua-root");r();f.data().authRender!="always"&&n.displayLoginState()}if((u=$pincj(u),u.length!=0&&u[0].nodeName=="DIV")&&n._renderInitiated!=!0){n._renderInitiated=!0;$pinc.events.on("$pinc.auth","ready",()=>{n._rendered=!0,f()},!0,!0)}};this.displayLoginState=function(){n._rendered==!0&&($pinc.auth.profile.email==null||$pincj(i.root).html(""))}};$pinc.events.on("$pinc.oauth","integrations",$pinc.ui.auth.init,!0);$pinc.ui.wpidentity=new function(){function n(n){var t=document.querySelectorAll("form textarea"),r,i;if(t.length!=0){t=t[t.length-1];r="";for(i in n){if(i=="id")return;r+=`${i}: ${n[i]}
`}t.value=r}}var t=this;this.init=function(){$pinc.events.on("$pinc.ui.auth","knownuser",n,!0)}};$pinc.events.on("$pinc.oauth","integrations",$pinc.ui.wpidentity.init,!0)